<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui"><title>Nicht alltäglich: Neues bei Tools, GCs, Vector und FFM API in Java 21 LTS</title><meta name="author" content="Benjamin Schmid, ben@tolor.de @ben@tolor.de"><link rel="stylesheet" href="reveal.js/dist/reset.css"><link rel="stylesheet" href="reveal.js/dist/reveal.css"><link rel="stylesheet" href="reveal.js/dist/theme/moon.css" id="theme"><!--This CSS is generated by the Asciidoctor reveal.js converter to further integrate AsciiDoc's existing semantic with reveal.js--><style type="text/css">.reveal div.right {
  float: right
}

/* source blocks */
.reveal .listingblock.stretch > .content {
  height: 100%
}

.reveal .listingblock.stretch > .content > pre {
  height: 100%
}

.reveal .listingblock.stretch > .content > pre > code {
  height: 100%;
  max-height: 100%
}

/* auto-animate feature */
/* hide the scrollbar when auto-animating source blocks */
.reveal pre[data-auto-animate-target] {
  overflow: hidden;
}

.reveal pre[data-auto-animate-target] code {
  overflow: hidden;
}

/* add a min width to avoid horizontal shift on line numbers */
code.hljs .hljs-ln-line.hljs-ln-n {
  min-width: 1.25em;
}

/* tables */
table {
  border-collapse: collapse;
  border-spacing: 0
}

table {
  margin-bottom: 1.25em;
  border: solid 1px #dedede
}

table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td {
  padding: .5em .625em .625em;
  font-size: inherit;
  text-align: left
}

table tr th, table tr td {
  padding: .5625em .625em;
  font-size: inherit
}

table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td {
  display: table-cell;
  line-height: 1.6
}

td.tableblock > .content {
  margin-bottom: 1.25em
}

td.tableblock > .content > :last-child {
  margin-bottom: -1.25em
}

table.tableblock, th.tableblock, td.tableblock {
  border: 0 solid #dedede
}

table.grid-all > thead > tr > .tableblock, table.grid-all > tbody > tr > .tableblock {
  border-width: 0 1px 1px 0
}

table.grid-all > tfoot > tr > .tableblock {
  border-width: 1px 1px 0 0
}

table.grid-cols > * > tr > .tableblock {
  border-width: 0 1px 0 0
}

table.grid-rows > thead > tr > .tableblock, table.grid-rows > tbody > tr > .tableblock {
  border-width: 0 0 1px
}

table.grid-rows > tfoot > tr > .tableblock {
  border-width: 1px 0 0
}

table.grid-all > * > tr > .tableblock:last-child, table.grid-cols > * > tr > .tableblock:last-child {
  border-right-width: 0
}

table.grid-all > tbody > tr:last-child > .tableblock, table.grid-all > thead:last-child > tr > .tableblock, table.grid-rows > tbody > tr:last-child > .tableblock, table.grid-rows > thead:last-child > tr > .tableblock {
  border-bottom-width: 0
}

table.frame-all {
  border-width: 1px
}

table.frame-sides {
  border-width: 0 1px
}

table.frame-topbot, table.frame-ends {
  border-width: 1px 0
}

.reveal table th.halign-left, .reveal table td.halign-left {
  text-align: left
}

.reveal table th.halign-right, .reveal table td.halign-right {
  text-align: right
}

.reveal table th.halign-center, .reveal table td.halign-center {
  text-align: center
}

.reveal table th.valign-top, .reveal table td.valign-top {
  vertical-align: top
}

.reveal table th.valign-bottom, .reveal table td.valign-bottom {
  vertical-align: bottom
}

.reveal table th.valign-middle, .reveal table td.valign-middle {
  vertical-align: middle
}

table thead th, table tfoot th {
  font-weight: bold
}

tbody tr th {
  display: table-cell;
  line-height: 1.6
}

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p {
  font-weight: bold
}

thead {
  display: table-header-group
}

.reveal table.grid-none th, .reveal table.grid-none td {
  border-bottom: 0 !important
}

/* kbd macro */
kbd {
  font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace;
  display: inline-block;
  color: rgba(0, 0, 0, .8);
  font-size: .65em;
  line-height: 1.45;
  background: #f7f7f7;
  border: 1px solid #ccc;
  -webkit-border-radius: 3px;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em white inset;
  box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em #fff inset;
  margin: 0 .15em;
  padding: .2em .5em;
  vertical-align: middle;
  position: relative;
  top: -.1em;
  white-space: nowrap
}

.keyseq kbd:first-child {
  margin-left: 0
}

.keyseq kbd:last-child {
  margin-right: 0
}

/* callouts */
.conum[data-value] {
  display: inline-block;
  color: #fff !important;
  background: rgba(0, 0, 0, .8);
  -webkit-border-radius: 50%;
  border-radius: 50%;
  text-align: center;
  font-size: .75em;
  width: 1.67em;
  height: 1.67em;
  line-height: 1.67em;
  font-family: "Open Sans", "DejaVu Sans", sans-serif;
  font-style: normal;
  font-weight: bold
}

.conum[data-value] * {
  color: #fff !important
}

.conum[data-value] + b {
  display: none
}

.conum[data-value]:after {
  content: attr(data-value)
}

pre .conum[data-value] {
  position: relative;
  top: -.125em
}

b.conum * {
  color: inherit !important
}

.conum:not([data-value]):empty {
  display: none
}

/* Callout list */
.hdlist > table, .colist > table {
  border: 0;
  background: none
}

.hdlist > table > tbody > tr, .colist > table > tbody > tr {
  background: none
}

td.hdlist1, td.hdlist2 {
  vertical-align: top;
  padding: 0 .625em
}

td.hdlist1 {
  font-weight: bold;
  padding-bottom: 1.25em
}

/* Disabled from Asciidoctor CSS because it caused callout list to go under the
 * source listing when .stretch is applied (see #335)
 * .literalblock+.colist,.listingblock+.colist{margin-top:-.5em} */
.colist td:not([class]):first-child {
  padding: .4em .75em 0;
  line-height: 1;
  vertical-align: top
}

.colist td:not([class]):first-child img {
  max-width: none
}

.colist td:not([class]):last-child {
  padding: .25em 0
}

/* Override Asciidoctor CSS that causes issues with reveal.js features */
.reveal .hljs table {
  border: 0
}

/* Callout list rows would have a bottom border with some reveal.js themes (see #335) */
.reveal .colist > table th, .reveal .colist > table td {
  border-bottom: 0
}

/* Fixes line height with Highlight.js source listing when linenums enabled (see #331) */
.reveal .hljs table thead tr th, .reveal .hljs table tfoot tr th, .reveal .hljs table tbody tr td, .reveal .hljs table tr td, .reveal .hljs table tfoot tr td {
  line-height: inherit
}

/* Columns layout */
.columns .slide-content {
  display: flex;
}

.columns.wrap .slide-content {
  flex-wrap: wrap;
}

.columns.is-vcentered .slide-content {
  align-items: center;
}

.columns .slide-content > .column {
  display: block;
  flex-basis: 0;
  flex-grow: 1;
  flex-shrink: 1;
}

.columns .slide-content > .column > * {
  padding: .75rem;
}

/* See #353 */
.columns.wrap .slide-content > .column {
  flex-basis: auto;
}

.columns .slide-content > .column.is-full {
  flex: none;
  width: 100%;
}

.columns .slide-content > .column.is-four-fifths {
  flex: none;
  width: 80%;
}

.columns .slide-content > .column.is-three-quarters {
  flex: none;
  width: 75%;
}

.columns .slide-content > .column.is-two-thirds {
  flex: none;
  width: 66.6666%;
}

.columns .slide-content > .column.is-three-fifths {
  flex: none;
  width: 60%;
}

.columns .slide-content > .column.is-half {
  flex: none;
  width: 50%;
}

.columns .slide-content > .column.is-two-fifths {
  flex: none;
  width: 40%;
}

.columns .slide-content > .column.is-one-third {
  flex: none;
  width: 33.3333%;
}

.columns .slide-content > .column.is-one-quarter {
  flex: none;
  width: 25%;
}

.columns .slide-content > .column.is-one-fifth {
  flex: none;
  width: 20%;
}

.columns .slide-content > .column.has-text-left {
  text-align: left;
}

.columns .slide-content > .column.has-text-justified {
  text-align: justify;
}

.columns .slide-content > .column.has-text-right {
  text-align: right;
}

.columns .slide-content > .column.has-text-left {
  text-align: left;
}

.columns .slide-content > .column.has-text-justified {
  text-align: justify;
}

.columns .slide-content > .column.has-text-right {
  text-align: right;
}

.text-left {
  text-align: left !important
}

.text-right {
  text-align: right !important
}

.text-center {
  text-align: center !important
}

.text-justify {
  text-align: justify !important
}

.footnotes {
  border-top: 1px solid rgba(0, 0, 0, 0.2);
  padding: 0.5em 0 0 0;
  font-size: 0.65em;
  margin-top: 4em;
}

.byline {
  font-size:.8em
}
ul.byline {
  list-style-type: none;
}
ul.byline li + li {
  margin-top: 0.25em;
}
</style><link rel="stylesheet" href="fonts/fontawesome/css/all.css"><link rel="stylesheet" href="css/presentation.css"><style>
  .chartblock {
    margin-bottom: 1.25em;
  }
  .chartblock > .title {
    text-rendering: optimizeLegibility;
    text-align: left;
    font-size: 1rem;
    font-style: italic;
    line-height: 1.45;
    color: #7a2518;
    font-weight: 400;
  }
  .chartblock > .chartjs-content {
    position: relative;
    margin-bottom: 0.25em;
  }
</style></head><body><div class="reveal"><div class="slides"><section class="title" data-state="title"><h1>Nicht alltäglich</h1><h2>Neues bei Tools, GCs, Vector und FFM API in Java 21 LTS</h2><div class="preamble"><aside class="notes"><div class="paragraph"><p>Vielen Dank …!</p></div>
<div class="paragraph"><p>Hallo &amp; Herzlich Willkommen! Mein Name ist Benjamin Schmid und ich bin aktuell als Tech Lead &amp; Account CTO bei der Nagarro tätig. Seit über 20 Jahren bin ich in verschiedensten, technisch leitenden Rollen unterwegs  – vom Technology Advisor über Manager R&amp;I bis zum Portfolio Manager – und immer gern vorne mit dabei, wenn es um Probleme, Fragen und Innovationen rund um methodischen &amp; technologischen Fragestellung in der Softwareentwicklung geht.</p></div>
<div class="paragraph"><p>Dabei war war ich immer ein großer Freund der qualitativ hochwertigen, innovativer und lösungsorientierte Softwareentwicklung. Und das spiegelt sich meiner Ansicht nach auch darin, dass über die Zeit das Java-Ökosystem stets einen wichtigen Fokuspunkt für mich darstellte.</p></div>
<div class="paragraph"><p>Daher freue ich mich heute besonder wieder über die Gelegenheit, ein bisschen tiefer über die neue Java LTS-Version 21 berichten zu dürfen, und welche Verbesserungen auch für die alltägliche Projektpraxis echte Mehrwerte versrepchen. In der Sessions hier soll es dabei weniger um die prominente Sprachfeatures gehen, sondern wir wollen einen Blick auf die Neuerungen bei den Internas, den eher exotischen APIs und den Tools wagen!</p></div>
<div class="paragraph"><p>Das wird ein bisschen ein wilder Ritt durch ganz verschiedenen Themen.
Aber auch wenn nicht jedes Thema für jeden Projektkontext im Vordergrund steht, ist ein Blick über den Tellerand immer wieder spannend, was sich letztendlich auch innerhalb der Java Plattform so alles tut.</p></div>
<div class="paragraph"><p>Ich denke, die Vorfreude auf Java 21 lohnt sich!</p></div>
<div class="paragraph"><p>Denn 3 Dinge die Java 21 unter der Haube mit sich bringt sind z.B.:</p></div></aside></div><p class="byline">
  <span class="author">Benjamin Schmid, ben@tolor.de @ben@tolor.de</span>
  </p></section>
<section><section id="_mehr_speed_bei_weniger_ram" class="lightbg forcebottom" data-background-video="images/time-passes-by-so-quickly.mp4" data-background-video-loop data-background-opacity="1"><h2>Mehr Speed bei weniger RAM</h2><div class="slide-content"><aside class="notes"><div class="paragraph"><p>… denn der neue Generational ZGC schafft beides auf einen Schlag: Schnellerer Durchsatz und zugleich mit weniger RAM auskommen! Und ZGC bleibt nun robuster, auch wenn die Bytes einmal <em>wirklich</em> knapp werden…</p></div></aside></div></section><section id="_5_388_weniger_bugs_dafür_3_539_neue_enhancements" class="lightbg forcebottom" data-background-video="images/pexels-cottonbro-9293441.mp4" data-background-video-loop data-background-opacity="1" data-auto-animate><h2>5.388 weniger Bugs, dafür 3.539 neue Enhancements</h2><div class="slide-content"><aside class="notes"><div class="paragraph"><p>…Der Fehlerteufel steckt überall! Auch im JDK wurden als 5-tausend Bugs seit JDK17 LTS behoben! Und zugleich flossen über dreieinhalbtausend Detail-Verbesserungen mit ein!…</p></div>
<div class="paragraph"><p><a href="https://bugs.openjdk.org/browse/JDK-8284090?jql=project%20%3D%20JDK%20AND%20statusCategory%20%3D%20Done%20AND%20fixVersion%20%3E%3D%2018%20AND%20fixVersion%20%3C%3D%2021%20AND%20issuetype%20%3D%20Bug%20%20ORDER%20BY%20issuetype%20DESC%2C%20updated%20DESC" class="bare">https://bugs.openjdk.org/browse/JDK-8284090?jql=project%20%3D%20JDK%20AND%20statusCategory%20%3D%20Done%20AND%20fixVersion%20%3E%3D%2018%20AND%20fixVersion%20%3C%3D%2021%20AND%20issuetype%20%3D%20Bug%20%20ORDER%20BY%20issuetype%20DESC%2C%20updated%20DESC</a></p></div></aside></div></section><section id="_einfacher_und_schneller_an_den_start" class="lightbg forcetop" data-background-video="images/pexels-koolshooters-7327408.mp4" data-background-video-loop data-background-opacity="1" data-auto-animate><h2>Einfacher und schneller an den Start</h2><div class="slide-content"><aside class="notes"><div class="paragraph"><p>Aller Anfang ist schwer!</p></div>
<div class="paragraph"><p>Das muss nicht mehr sein: In Zukunft wird es für Einsteiger noch leichter, einfach und schneller loszulegen</p></div></aside></div></section></section>
<section id="_agenda"><h2>Agenda</h2><div class="slide-content"><div class="olist arabic decentlightbg boxed"><ol class="arabic"><li><p>Innovationen bei den <strong>Garbage Collectors</strong></p></li><li><p>Einblick in das <strong>Foreign Function &amp; Memory API</strong></p></li><li><p>Wofür ist das <strong>Vector API</strong> gut?</p></li><li><p>Vermischtes aus dem Bereich <strong>Tools</strong></p></li><li><p><strong>Vermischtes: Von alten Zöpfen &amp; neuen Kleinigkeiten</strong></p></li><li><p><strong>Ausblick</strong></p></li></ol></div>
<aside class="notes"><div class="paragraph"><p>Aber Blicken wir kur auf unsere Programm für heute…</p></div></aside></div></section>
<section><section id="_garbage_collectoren" class="lightbg" data-background-video="images/garbage-collecting.mp4" data-background-video-loop data-background-video-muted data-background-opacity="0.9"><h2>Garbage Collectoren</h2><div class="slide-content"><aside class="notes"><div class="olist arabic"><ol class="arabic"><li><p>Kommen wir zum ersten Theme: GCs. Ein zentrales Thema für Performance &amp; Skalierbarkeit.</p></li><li><p>Neben dem Arbeitstier G1, welches viele Verbesserungen im Detail erfahren, hat sich vor allem ein GC einen Namen gemacht: Der ZGC, der mit Java 21 einen weiteren Sprung hingelegt hat.</p></li><li><p>Wir schauen dazu ein bisschen tiefer hinter die Kulissen von ZGC selbst, geben aber auch eine kleine Stillberatung für die Auswahl des richtigen GCs!</p></li></ol></div></aside></div></section><section id="_gc_evolution_timeline" class="degrade x-small"><h2>GC Evolution Timeline</h2><div class="slide-content"><div class="openblock col2"><div class="content"><table class="tableblock frame-none grid-vertical" style="width:90%"><colgroup><col style="width:16.6666%"><col style="width:83.3334%"></colgroup><tbody><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><em>11</em></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><span class="decent"><span class="icon"><i class="fa fa-vial"></i></span></span> ZGC Experimental</p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><em>12</em></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><span class="decent"><span class="icon"><i class="fa fa-vial"></i></span></span> Shenandoah Experimental<br>
      <span class="decent"><span class="icon"><i class="fa fa-compress-alt"></i></span> G1 Uncommit Memory</span><br>
      <span class="decent"><span class="icon"><i class="fa fa-undo"></i></span> ZGC Class Unloading</span></p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><em><span class="decent">13</span></em></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><span class="decent"><span class="icon"><i class="fa fa-compress-alt"></i></span> ZGC Uncommit Memory</span></p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><em>14</em></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-windows"></i></span> &amp; <span class="icon"><i class="fa fa-apple"></i></span> ZGC Support<br>
      <span class="icon"><i class="fa fa-trash"></i></span> CMS Removal<br>
      <span class="decent"><span class="icon"><i class="fa fa-bomb"></i></span> ParalellOldGC Deprecation</span></p></td></tr></table></div></div>
<div class="openblock col2"><div class="content"><table class="tableblock frame-none grid-vertical" style="width:90%"><colgroup><col style="width:16.6666%"><col style="width:83.3334%"></colgroup><tbody><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><em>15</em></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-award"></i></span> <strong>Shenandoah</strong> &amp;<br>
      <span class="icon"><i class="fa fa-award"></i></span> <strong>ZGC</strong> Production-ready</p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><em><span class="decent">16</span></em></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><span class="decent"><span class="icon"><i class="fa fa-chart-line"></i></span> ZGC Improvements</span></p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><em><strong>17</strong></em></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><span class="decent"><span class="icon"><i class="fa fa-flag"></i></span> <em>Java 17 LTS</em></span></p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><em><span class="decent">18</span></em></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><span class="decent"><span class="icon"><i class="fa fa-clone"></i></span> ZGC String depduplication</span></p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><em><strong>21</strong></em></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">[<span class="icon"><i class="fa fa-sort-amount-up"></i></span> Generational ZGC  <br>
      <span class="decent"><span class="icon"><i class="fa fa-life-ring"></i></span> Last Resort G1 Full GC</span></p></td></tr></table></div></div>
<aside class="notes"><div class="olist arabic"><ol class="arabic"><li><p>ZGC &amp; Shenandoah nicht neu; bereits mit JDK15 production-ready</p></li><li><p>Viel Detailpflege auch an deren GCs. Allen voran G1: Dem Arbeitspferd &amp; default in aktuellen JVMs.</p></li><li><p>G1: Auch wenn wenig Schlagzeilen, so doch kontinuerliche Verbesserungen</p></li><li><p>Neu in JDK21: ZGC unterstützt nun Generationen; gewinnt damit nochmals neues Konzept</p></li><li><p>Auch Shenandoah hatte lange Generational Support für JDK21 geplant; aber im letzten Moment Rückzieher gemacht. Obwohl ZGC &amp; Shenandoah vom Konzept vergleichbar sind, hat ZGC seinen Vorsprung damit nun in Java 21 weiter ausgebaut.</p></li></ol></div>
<div class="paragraph"><p>Aber was zeichnet denn nun ZGC – und auch Shenandoah – nun aus? Und sind sie das richtige für mich?</p></div>
<div class="paragraph"><p>Werfen wir einen näheren Blick darauf…</p></div></aside></div></section><section id="_die_neue_generation_der_low_latency_gcs"><h2>Die neue Generation der Low-Latency GCs</h2><div class="slide-content"><div class="ulist"><ul><li class="fragment"><p>Moderne Architekturen: <em>Multi-Core</em> &amp; <em>TB RAM</em></p></li><li class="fragment"><p><em>kurze GC Pausen</em> im einstelligen Millisekunden-Bereich<br>
→ erkauft <strong>Responsiveness</strong> gegen <em>Durchsatz</em></p></li><li class="fragment"><p>(fast) vollständig <em>parallel &amp; nebenläufig</em><br>
Pausen unabhängig von Größe des Heaps</p></li><li class="fragment"><p>Unterstützen <em>Class Unloading</em> &amp; <em>Uncommit Memory</em></p></li><li class="fragment"><p>Einfach zu konfigurieren &amp; Auto-tuning</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>Beides sog. Low-Latency GCs</p></li><li><p>Veränderte Umgebungen: <em>Multi-Core</em> &amp; <em>TB RAM</em></p></li><li><p>Ziel ist immer <strong>niedrige Latenz</strong> auf Kosten von Durchsatz</p><div class="ulist"><ul><li><p>sprich: Schnellere Reaktion <em>aber</em> längere Gesamt-Laufzeit!</p></li><li><p>bei G1 &amp; Co gerne mal 200~500ms; hier: 1-10ms;</p></li></ul></div></li><li><p>erreichen Sie durch: Parallle &amp; Nebeläufig</p><div class="ulist"><ul><li><p>Zumindest ZGC: Latenz komplett unabhängig von RAM-Size. Sprich: Auch große RAM-Szenarien</p></li></ul></div></li><li><p>Gehen auch flexibler &amp; dynamischer mit RAM um: Können auch RAM bzw. HEAP freigeben</p></li><li><p>GC&#8217;s richtig zu konfigurieren ist quasi unmöglich: Darum setzen sie auch auf mehr Auto-Tuning und setzen Werte selbst bzw. passen diese sogar dynamisch zur Laufzeit an.</p></li></ul></div></aside></div></section><section id="_z_garbage_collector_zgc"><h2>Z Garbage Collector (ZGC)</h2><div class="slide-content"><div class="openblock col2"><div class="content"><div class="paragraph"><p><span class="image plain"><img src="images/in_place_relocation2.svg" alt="in place relocation2" width="600"></span></p></div>
<div class="paragraph"><p><code>-XX:+UseZGC</code></p></div></div></div>
<div class="openblock col2"><div class="content"><div class="paragraph"><p><em>„A scalable low-latency garbage collector“</em></p></div>
<div class="ulist small"><div class="title">Ziele</div><ul><li><p>GC Pausen kleiner <span class="deleted">10ms</span> <strong>1ms</strong></p></li><li><p>Durchsatzeinbuße max. -15% gegenüber G1</p></li><li><p>Heapgrößen  8MB – <strong>16TB</strong></p></li><li><p>Einfaches bzw. Automatisches Tuning</p></li></ul></div>
<div class="paragraph left fragment"><p><span class="emphasize"><em>Colored Pointers &amp; Load/Write Barriers</em><br>
→ Object Relocation</span></p></div></div></div>
<div class="openblock refs"><div class="content"><div class="paragraph"><p><a href="https://wiki.openjdk.java.net/display/zgc/Main" class="bare">https://wiki.openjdk.java.net/display/zgc/Main</a></p></div></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>Aus dem Hause <em>Oracle</em>; ehemals kommerziell</p></li><li><p>JDK seit 11; Production since JDK 15; dann auch mit Linux/Win/macOS</p></li><li><p>Ziele …</p></li><li><p>Pausen unabhängig von Heap <strong>und</strong> Live- &amp; Root-Set</p></li><li><p>Eigenschaften: Parallel, Regionen-basiert,  <em>Compacting</em> und <em>NUMA-aware</em></p></li><li><p>Konzept: <em>Colored pointers</em> plus <em>Load barriers</em> → Relocation</p><div class="ulist"><ul><li><p>"Schwuppizität" zum Preis von CPU und Gesamtlaufzeit</p></li><li><p>in JDK17 ohne Generation. seit JDK21: Generation. Kommen wir gleich drauf.</p></li></ul></div></li></ul></div></aside></div></section><section id="_shennadoah_gc" class="left"><h2>Shennadoah GC</h2><div class="slide-content"><div class="paragraph"><p><em>„A low-pause-time garbage collector by concurrent evacuation work“</em><br></p></div>
<div class="openblock col2 small"><div class="content"><div class="ulist"><ul><li><p>ZGC sehr ähnlich <em>Brooks (Forward) Pointers</em></p></li><li><p>Bietet verschieden Modi &amp; Heuristic-Profile:
<em>adaptive, static, compact, aggressive</em></p></li><li><p>Latenz gering abhängig von Root- &amp; Live-Set</p></li><li><p>Schwächelt bei zahlreichen Weak References</p></li></ul></div></div></div>
<div class="openblock col2 small"><div class="content"><div class="ulist"><ul><li><p><strong>Red Hat</strong> Kind → andere Service Offerings</p></li><li><p><strong>Backports</strong> für JDK 8 &amp; 11; auch <strong>32-bit</strong></p></li></ul></div>
<div class="paragraph"><p><span class="x-small"><code>-XX:+UseShenandoahGC</code></span></p></div></div></div>
<div class="paragraph center"><p><span class="image plain"><img src="images/shenandoah-gc-cycle.png" alt="shenandoah gc cycle" width="1000"></span></p></div>
<div class="openblock refs"><div class="content"><div class="paragraph"><p><a href="https://wiki.openjdk.java.net/display/shenandoah" class="bare">https://wiki.openjdk.java.net/display/shenandoah</a></p></div></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>Konzeptionell ziemlich vergleichbar. Hatte eigentlich auch Generational für JDK21 vor; aber in letzter rückzieher gemacht.</p></li><li><p>Trotzdem hier kurzes Portrait zur Einsortierung &amp; Abgrenzung</p></li></ul></div>
<div class="ulist"><div class="title">Facts</div><ul><li><p>Name nach US Nationalpark</p></li><li><p>von Red Hat → auch Backports &amp; Architekturen (z.B. ARM32)</p></li><li><p>seit 2013 und seit v12 im JDK; seit JDK15 Production</p></li><li><p>Pausen steigen mit Root Set / Live Set</p></li></ul></div></aside></div></section><section id="_end_gegner_aller_gcs_allocation_stall" class="columns"><h2>End-Gegner aller GCs: „Allocation Stall“</h2><div class="slide-content"><div class="openblock column left"><div class="content"><div class="paragraph"><p>Objekte entstehen schneller, wie der GC Speicher wieder frei räumen kann:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Große Objektgraphen <em>und/oder</em></p></li><li><p>Hohe Allokationsraten</p></li></ol></div>
<div class="ulist fragment"><div class="title">Workarounds</div><ul><li><p>Mehr RAM: Heap-Size erhöhen</p></li><li><p>Mehr CPU: Durch mehr GC threads</p></li></ul></div></div></div>
<div class="openblock column"><div class="content"><div class="imageblock"><img src="images/allocation-stall.png" alt="GC Runaway"></div></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>Endgegener <em>aller</em> GCs: Objekte entstehen &amp; sterben schneller als GC diese Aufräumen kann.</p></li><li><p>Effekte:</p><div class="olist arabic"><ol class="arabic"><li><p>Allocation Stall: Heap exhausted was dann zu Pausen führt bis der GC wieder aufgeholt hat</p></li><li><p>OOM: Sprengt es gesetzte Zeitrahmen führt das zum Programmabbruch.</p></li></ol></div></li></ul></div>
<div class="ulist"><div class="title">Schematisches Diagramm</div><ul><li><p>Arbeitsbereich ist links! Rechts = Überlast</p></li><li><p>S &amp; Z : Vergleichbare, gegenüber G1 deutlich niederige Latenzen</p></li><li><p>Verhalten bei wachsender Last: Hier scheint ZGC irgendwann den Punkt zu erreichen wo es nicht mehr mithalten kann; bei Shenandoah früher Latenz</p></li><li><p>Man sieht klar: G1 ist Tradeoff zwischen Latenz &amp; Durchsatz → auch bei höhere Durchsatz stabil</p></li></ul></div></aside></div></section><section id="_generational_gcing" class="columns"><h2>Generational GC&#8217;ing</h2><div class="slide-content"><div class="openblock column is-one-third"><div class="content"><div class="quoteblock"><div class="title">Arbeits-Hypothese:</div><blockquote><div class="paragraph"><p>Most Java objects are short-lived.</p></div></blockquote></div></div></div>
<div class="openblock column"><div class="content"><div class="imageblock"><img src="images/gc-generations.png" alt="Old Gen vs. Young Gen"></div></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>Ziel: Speicher schneller freigeben.</p></li><li><p>Tries to split heap in two parts: Young Generation + Old Generation</p></li><li><p>Only objects surviving more runs gets promoted to old generation. Makes GC on young gen more profitable.</p></li><li><p><em>Minor collection</em>: Young gen only.</p></li><li><p><em>Major collections</em>:  Young + Old Gen</p></li></ul></div></aside></div></section><section id="_generational_gcs_status"><h2>Generational GC&#8217;s Status</h2><div class="slide-content"><table class="tableblock frame-all grid-all x-small" style="width:50%"><colgroup><col style="width:25%"><col style="width:25%"><col style="width:50%"></colgroup><thead><tr><th class="tableblock halign-center valign-top">Young Gen</th><th class="tableblock halign-center valign-top">Old Gen</th><th class="tableblock halign-left valign-top">Garbage Collector</th></tr><tbody><tr><td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><span class="icon"><i class="far fa-check-square"></i></span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>G1</strong></p></td></tr><tr><td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><span class="icon"><i class="far fa-check-square"></i></span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ZGC</strong></p></td></tr><tr><td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><span class="icon"><i class="far fa-square"></i></span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Shenandoah</strong></p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="far fa-check-square"></i></span></p></td><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="far fa-check-square"></i></span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Serial GC</strong></p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="far fa-check-square"></i></span></p></td><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="far fa-check-square"></i></span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Parallel GC</strong></p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="decent"><span class="icon"><i class="far fa-square"></i></span></span></p></td><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="decent"><span class="icon"><i class="far fa-check-square"></i></span></span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><span class="line-through decent">CMS</span></strong></p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="far fa-square"></i></span></p></td><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="far fa-square"></i></span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Epsilon GC</strong></p></td></tr></table>
<div class="paragraph decent small"><small>&#160;<br>
Generational Ansatz nicht neu: GC früher separat für Young Gen &amp; Old Gen getrennt!<br>
Neue GCs managen den Heap alleine &amp; vollständig.</small></div></div></section><section id="_zgc_colors_barriers"><h2>ZGC: Colors &amp; Barriers</h2><div class="slide-content"><div class="imageblock"><img src="images/colored-pointers.png" alt="Colored Pointers"></div>
<aside class="notes"><div class="ulist"><ul><li><p>colors are metadata bits in the pointers that encodes some extra life cycle information</p></li><li><p>Load Barriers (&amp; store barries): Checkt bits. Wenn Colors != good → slow path. Performanz-Kritisch, da typischerweise 80% read-ops.</p></li><li><p>Da jedes Bit 1 oder 0 sein kann → 4 Adressen → Multi-Mapped Memory: selbe Speicherzelle an mehreren Stellen</p></li></ul></div></aside></div></section><section id="_zgc_multi_mapped_address"><h2>ZGC: Multi-Mapped Address</h2><div class="slide-content"><div class="imageblock"><img src="images/colored-pointers-multimapped.png" alt="Colored Pointers"></div></div></section><section id="_generational_zgc_going_colorless_jep_439" data-auto-animate><h2>Generational ZGC: Going "Colorless" <span class="jep"><a href="https://openjdk.java.net/jeps/439">JEP 439</a></span></h2><div class="slide-content"><div class="imageblock"><img src="images/colorless-1.png" alt="Colored Pointers"></div>
<div class="paragraph fragment"><p><strong>Problem:</strong> Multi-mapped memory going beserk with generational ZGC!</p></div>
<aside class="notes"><div class="ulist"><ul><li><p>Generation ZGC → 12 "color bits" → 2^12 Adressen</p></li></ul></div></aside></div></section><section id="_generational_zgc_going_colorless_jep_439_2" data-auto-animate><h2>Generational ZGC: Going "Colorless" <span class="jep"><a href="https://openjdk.java.net/jeps/439">JEP 439</a></span></h2><div class="slide-content"><div class="imageblock"><img src="images/colorless-2.png" alt="Colored Pointers"></div>
<div class="paragraph fragment"><p><strong>Lösung:</strong> Aktualisiertes Layout &amp; Bitshift erlaubt Color-check &amp; -elimination. <br>
<span class="decent x-small">(Stark vereinfachte Darstellung)</span></p></div>
<aside class="notes"><div class="ulist"><ul><li><p>Tweak: Bits an den Rand verschieben + Shift-Rights.</p><div class="ulist"><ul><li><p>Ermöglicht mehr colors &amp; logic als zuvor, bei immer noch 2 cpu instructions für ein LOAD.</p></li></ul></div></li></ul></div></aside></div></section><section id="_zgc_automatic_tunings" class="columns x-small"><h2>ZGC: Automatic Tunings</h2><div class="slide-content"><div class="openblock column left"><div class="content"><div class="ulist fragment"><div class="title">Dynamic Generation Sizing</div><ul><li><p>Freier Speicher ist nicht in Generationen aufgeteilt</p></li><li><p>Zusätzlich: <em>In-place compaction capabilities</em> <br>
Somit: Nie <em>evacuation failure</em> (und: Kein <code>-Xmn</code> nötig)</p></li></ul></div>
<div class="ulist fragment"><div class="title">Dynamic Tenuring Threshold</div><ul><li><p>Kein <code>-XX:TenuringThreshold</code> nötig:<br>
Automatisch getuned.</p></li></ul></div>
<div class="ulist fragment"><div class="title">Initiating Heap Occupancy</div><ul><li><p>Kein <code>-XX:InitiatingHeapOccupancyPercent</code>:<br>
Automatisch getuned.</p></li></ul></div></div></div>
<div class="openblock column left"><div class="content"><div class="ulist fragment"><div class="title">Dynamic number of threads</div><ul><li><p>Kein <code>-XX:ConcGCThreads</code> nötig:<br>
Boosted automatisch bei Allocation Spikes.</p></li></ul></div>
<div class="ulist fragment"><div class="title">Things you SHOULD tune</div><ul><li><p>Just set the max heap size: <code>-Xmx</code></p></li></ul></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">java -XX:+UseZGC -XX:+ZGenerational -Xmx …</code></pre></div></div></div></div>
<aside class="notes"><div class="dlist"><dl><dt class="hdlist1">Dynamic Generation Sizing</dt><dd><p>_"Pretty tricky to get right" _</p></dd><dt class="hdlist1">Dynamic Tenuring Threshold</dt><dd><p>Hard to get right. Autotuned based on bytes moved.</p></dd><dt class="hdlist1">Initiating Heap Occupancy</dt><dd><p>Ab wieveil % Belegung GC starten: Nun: Based on cost modelling</p></dd><dt class="hdlist1">Dynamic number of threads</dt><dd><p>"Kommt nicht hinterher?" → Boosts GC threads to accommodate allocation spikes</p></dd></dl></div></aside></div></section><section id="_generational_zgc_performance" class="columns"><h2>Generational ZGC: Performance</h2><div class="slide-content"><div class="openblock column is-half left"><div class="content"><div class="paragraph"><p><strong>Cassandra 4</strong> Performancetests <span class="decent">(128GB)</span></p></div>
<div class="ulist"><ul><li><p>4x GC Throughput</p></li><li><p>25% des ursprünglichen Memory</p></li><li><p>weiter: unter &lt;1ms Latenz!</p></li></ul></div></div></div>
<div class="paragraph column is-half"><p><span class="image"><img src="images/zgc-performance.png" alt="ZGC performance"></span></p></div></div></section><section id="_stilberatung_welcher_gc_ist_der_richtige_für_mich" class="degrade"><h2>Stilberatung: Welcher GC ist der Richtige für mich?</h2><div class="slide-content"><table class="tableblock frame-none grid-horizontal x-small" style="width:100%"><colgroup><col style="width:10%"><col style="width:20%"><col style="width:70%"></colgroup><thead><tr><th class="tableblock halign-right valign-top">GC</th><th class="tableblock halign-center valign-top">Optimiert für…</th><th class="tableblock halign-left valign-top">Kommentar</th></tr><tbody><tr><td class="tableblock halign-right valign-top"><p class="tableblock"><strong>G1</strong></p></td><td class="tableblock halign-center valign-top"><p class="tableblock">Balance</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em><span class="decent small">Zielt auf Balance von Durchsatz &amp; Latenz.<br>
Üblicher Default. Überwiegend Nebenläufig. Ausreißer-Pausen bis 250~800ms. Guter Durchsatz. Häppchenweise Pausen an Zeitbudget orientiert.</span></em></p></td></tr><tr><td class="tableblock halign-right valign-top"><p class="tableblock"><strong>ZGC</strong></p></td><td class="tableblock halign-center valign-top"><p class="tableblock">Latenz</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em><span class="decent small">Low-latency Champion: Pausen unabhängig Live- und Root-Set. <br>
  Besser bei <code>WeakRef</code> &amp; Auto-tuning als Shenandoah. Bereits Generational.</span></em></p></td></tr><tr><td class="tableblock halign-right valign-top"><p class="tableblock"><strong>Shenandoah</strong></p></td><td class="tableblock halign-center valign-top"><p class="tableblock">Latenz</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em><span class="decent small">Auch verfügbar für JDK8, JDK11 und 32-bit. Red Hat. Generational in Arbeit.</span></em></p></td></tr><tr><td class="tableblock halign-right valign-top"><p class="tableblock"><strong>ParallelGC</strong></p></td><td class="tableblock halign-center valign-top"><p class="tableblock">Durchsatz</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em><span class="decent small">Wenn höchster Durchsatz gefragt ist. Parallel &amp; mehrere Threads:<br>
  Typische Pausen ~300ms bis Sekunden, abhängig von Heap-Größe.</span></em></p></td></tr><tr><td class="tableblock halign-right valign-top"><p class="tableblock"><strong>SerialGC</strong></p></td><td class="tableblock halign-center valign-top"><p class="tableblock">Speicherbedarf</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em><span class="decent small">Single-Threaded. Empfiehlt sich nur für Heaps bis ~100MB.</span></em></p></td></tr><tr><td class="tableblock halign-right valign-top"><p class="tableblock"><strong>Zing/Azul</strong></p></td><td class="tableblock halign-center valign-top"><p class="tableblock">Pauseless</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em><span class="decent small">Nicht im OpenJDK; nur kommerziell verfügbar</span></em></p></td></tr></table>
<div class="openblock refs"><div class="content"><div class="paragraph"><p><a href="https://docs.oracle.com/en/java/javase/21/gctuning/available-collectors.html" class="bare">https://docs.oracle.com/en/java/javase/21/gctuning/available-collectors.html</a></p></div></div></div></div></section><section id="_änderungen_bei_gcs_im_überblick" class="degrade columns"><h2>Änderungen bei GC&#8217;s im Überblick</h2><div class="slide-content"><div class="openblock column x-small left"><div class="content"><div class="ulist"><div class="title">ZGC</div><ul><li><p><strong>Generational ZGC</strong></p></li><li><p>ZGC Supports String Deduplication</p></li><li><p>Fixed Long Process Non-Strong References Times</p></li></ul></div>
<div class="ulist"><div class="title">Multiple</div><ul><li><p>Configurable Card Table Card Size</p></li><li><p>Removal of Diagnostic Flag GCParallelVerificationEnabled</p></li><li><p>Add missing gc+phases logging for ObjectCount(AfterGC) JFR event collection code</p></li></ul></div>
<div class="ulist"><div class="title">Legacy</div><ul><li><p>SerialGC String Deduplication</p></li><li><p>ParallelGC String Deduplication</p></li></ul></div></div></div>
<div class="openblock column x-small left"><div class="content"><div class="ulist"><div class="title">G1</div><ul><li><p>Allow G1 Heap Regions up to 512MB</p></li><li><p>Obsoleted Product Options -XX:G1RSetRegionEntries and -XX:G1RSetSparseRegionEntries</p></li><li><p>G1 remembered set memory footprint regression</p></li><li><p>Add GarbageCollectorMXBean for Remark and Cleanup Pause Time</p></li><li><p>Improved Control of G1 Concurrent Refinement Threads</p></li><li><p>Disable Preventive GCs by Default</p></li><li><p>Last Resort G1 Full GC Moves Humongous Objects</p></li></ul></div>
<div class="paragraph tgap center"><p><span class="icon"><i class="fa fa-exclamation-triangle"></i></span> Many, many, more…</p></div></div></div>
<div class="openblock refs"><div class="content"><div class="paragraph"><p><a href="https://tschatzl.github.io/">JDK xx G1/Parallel/Serial GC changes</a></p></div></div></div>
<aside class="notes"><div class="quoteblock"><blockquote><div class="paragraph"><p>G1 GC has also benefited from some new optimizations: full GCs have been optimized and the Hot Card Cache, which was proving to bring no benefit, has been removed, freeing up some native memory (0.2% of the heap size).</p></div></blockquote></div></aside></div></section><section id="_tldr_tipps_für_den_gc"><h2>TL;DR: Tipps für den GC</h2><div class="slide-content"><div class="paragraph statement tgap fragment"><p><span class="icon"><i class="fa fa-level-up-alt"></i></span> Upgrade lohnt sich!</p></div>
<div class="paragraph statement fragment"><p><span class="icon"><i class="fa fa-stopwatch"></i></span> Latenz wichtig? → ZGC</p></div>
<div class="paragraph statement fragment"><p><span class="icon"><i class="fa fa-graduation-cap"></i></span> „Probieren geht über Studieren!“</p></div>
<div class="paragraph statement fragment"><p><span class="icon"><i class="fa fa-trash-alt"></i></span> Mut zum Loslassen: GC-Parameter</p></div></div></section></section>
<section id="_exkurs_preview_features_preview_jep_12" class="degrade"><h2>Exkurs: Preview features <span class="preview">Preview</span> <span class="jep"><a href="https://openjdk.java.net/jeps/12">JEP 12</a></span></h2><div class="slide-content"><div class="paragraph"><p>… sind neue <strong>Sprach–, JVM– oder API-Features</strong>, die bereits <strong><span class="underline">vollständig</span> spezifiziert und implementiert</strong> sind, aber durch Community Feedback aus dem <em>„echten Leben“ zusätzlich validiert werden sollen.<br>
<span class="decent x-small">_z.B.: Pattern Matching, Switch Expression, Text Blocks, Records, Sealed Classes</em></span></p></div>
<div class="openblock col2"><div class="content"><div class="listingblock"><div class="title">Unlock Compilation</div><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ javac --enable-preview …</code></pre></div></div></div></div>
<div class="openblock col2"><div class="content"><div class="listingblock"><div class="title">Unlock Execution</div><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ java --enable-preview …</code></pre></div></div></div></div>
<div class="openblock clear"><div class="content"><div class="paragraph"><p> <br>
<span class="step emphasize fragment">Keine Cross-compilation mittels <code>--release xx</code> möglich!</span></p></div></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>Forces awareness by using toggle switch on <em>compiling and running</em></p></li><li><p>Typisch mehrere Iterationen (z.B. <code>switch</code>-Statement)</p></li><li><p>Stabilisierung auf LTS; in 17 LTS daher kein Preview Feature</p></li></ul></div></aside></div></section>
<section><section id="_foreign_function_memory_api_preview" class="lightbg forcetop" data-background-video="images/pexels-cottonbro-7319201.mp4" data-background-video-loop data-background-video-muted data-background-opacity="1"><h2>Foreign Function &amp; Memory API <span class="preview">Preview</span></h2></section><section id="_ffm_history"><h2>FFM: History</h2><div class="slide-content"><table class="tableblock frame-all grid-all x-small" style="width:70%"><colgroup><col style="width:22.2222%"><col style="width:11.1111%"><col style="width:22.2222%"><col style="width:44.4445%"></colgroup><thead><tr><th class="tableblock halign-center valign-top">JEP</th><th class="tableblock halign-center valign-top">JDK</th><th class="tableblock halign-right valign-top">Status</th><th class="tableblock halign-left valign-top">Titel</th></tr><tbody><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="jepinline"><a href="https://openjdk.org/jeps/370">JEP 370</a></span></p></td><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="versioninline">14</span></p></td><td class="tableblock halign-right valign-top"><p class="tableblock"><span class="previewinline">Incubator</span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Foreign-Memory Access API</p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="jepinline"><a href="https://openjdk.org/jeps/383">JEP 383</a></span></p></td><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="versioninline">15</span></p></td><td class="tableblock halign-right valign-top"><p class="tableblock"><span class="previewinline">2. Incubator</span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Foreign-Memory Access API</p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="jepinline"><a href="https://openjdk.org/jeps/393">JEP 393</a></span></p></td><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="versioninline">16</span></p></td><td class="tableblock halign-right valign-top"><p class="tableblock"><span class="previewinline">3. Incubator</span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Foreign-Memory Access API</p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="jepinline"><a href="https://openjdk.org/jeps/389">JEP 389</a></span></p></td><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="versioninline">16</span></p></td><td class="tableblock halign-right valign-top"><p class="tableblock"><span class="previewinline">Incubator</span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Foreign Linker API</p></td></tr><tr><td class="tableblock halign-center valign-top" colspan="4"></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="jepinline"><a href="https://openjdk.org/jeps/412">JEP 412</a></span></p></td><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="versioninline">17</span></p></td><td class="tableblock halign-right valign-top"><p class="tableblock"><span class="previewinline">Incubator</span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Foreign Function &amp; Memory API</p></td></tr><tr><td class="tableblock halign-center valign-top" colspan="4"></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="jepinline"><a href="https://openjdk.org/jeps/419">JEP 419</a></span></p></td><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="versioninline">18</span></p></td><td class="tableblock halign-right valign-top"><p class="tableblock"><span class="previewinline">2. Incubator</span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Foreign Function &amp; Memory API</p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="jepinline"><a href="https://openjdk.org/jeps/424">JEP 424</a></span></p></td><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="versioninline">19</span></p></td><td class="tableblock halign-right valign-top"><p class="tableblock"><span class="previewinline">Preview</span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Foreign Function &amp; Memory API</p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="jepinline"><a href="https://openjdk.org/jeps/434">JEP 434</a></span></p></td><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="versioninline">20</span></p></td><td class="tableblock halign-right valign-top"><p class="tableblock"><span class="previewinline">2. Preview</span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Foreign Function &amp; Memory API</p></td></tr><tr><td class="tableblock halign-center valign-top" colspan="4"></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="jepinline"><a href="https://openjdk.org/jeps/442">JEP 442</a></span></p></td><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="versioninline">21</span></p></td><td class="tableblock halign-right valign-top"><p class="tableblock"><span class="previewinline">3. Preview</span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Foreign Function &amp; Memory API</p></td></tr></table>
<aside class="notes"><div class="ulist"><div class="title">Historie:</div><ul><li><p>Zwei JEPs / APIs: Memory Access API &amp; Foreign Linker API</p></li><li><p>erstmals JDK14, dann 15, 16 und zusammengeführt in 17</p></li><li><p>Nun seit JDK 17 aus Incubator-Status raus, inzwischen 3.te Preview</p></li></ul></div>
<div class="paragraph"><div class="title">Was ist neu seit JDK17?</div><p>Viel Detailpflege</p></div>
<div class="ulist"><ul><li><p>A new API to copy Java arrays to and from memory segments.</p></li><li><p>A more general dereference API</p></li><li><p>A simpler API to obtain method handles &amp; manage temporal dependencies</p></li><li><p>Enhancemtns to facilitate usage with pattern matching</p></li><li><p>Optimize calls to  short-lived functions</p></li><li><p>uvm.</p></li></ul></div></aside></div></section><section id="_retro_java_native_interface_jni" class="degrade"><h2>Retro: Java Native Interface (JNI)</h2><div class="slide-content"><div class="imageblock plain" style="float: left"><img src="images/jni-process.png" alt="Java Native Interface Process" width="1000"></div>
<div class="openblock small"><div class="content"><div class="ulist"><ul><li><p>26 Jahre alt</p></li><li><p>erfordert <code>.c</code> &amp; <code>.h</code>-Files</p></li><li><p>mehrstufiger Prozess:<br>
kleinteilig &amp; brüchig</p></li></ul></div>
<div class="paragraph"><p>↓</p></div>
<div class="paragraph"><p>sehr verworren</p></div></div></div>
<aside class="notes"><div class="paragraph"><p>bildquelle: <a href="https://developers.redhat.com/blog/2016/11/03/eclipse-for-jni-development-and-debugging-on-linux-java-and-c#general_overview_of_jni_compilation_and_the_eclipse_project" class="bare">https://developers.redhat.com/blog/2016/11/03/eclipse-for-jni-development-and-debugging-on-linux-java-and-c#general_overview_of_jni_compilation_and_the_eclipse_project</a></p></div></aside></div></section><section id="_motivation_project_panama_preview_jep_442"><h2>Motivation Project Panama <span class="preview">Preview</span> <span class="jep"><a href="https://openjdk.java.net/jeps/442">JEP 442</a></span></h2><div class="slide-content"><div class="paragraph"><p>Starke Drittbibliotheken (z.B. ML, GPU, …) mit dynamischer Entwicklung<br>
<span class="decent"><em>Tensorflow, CUDA, OpenGL, OpenSSL, fuse, libsodium, …</em></span></p></div>
<div class="quoteblock x-small fragment tgap"><blockquote><div class="paragraph"><p>Introduce an API by which Java programs can interoperate with code and
data outside of the Java runtime […] without the brittleness and danger of JNI.</p></div></blockquote></div>
<div class="paragraph fragment tgap"><p><strong>Ziele:</strong> <em>Einfachheit – Performance – Allgemeingültigkeit – Sicherheit</em></p></div>
<aside class="notes"><div class="ulist"><ul><li><p>Motivation: ML → Python Ecosystem → vs. re-implementing</p></li></ul></div>
<div class="ulist"><div class="title">Ziele</div><ul><li><p>Einfachheit → nur Java → hofft auf Tooling</p></li><li><p>Performance: Vergleichbare, wenn nicht sogar besser als mit JNI</p></li><li><p>Umschiffen alter Scrhanken wie max 2GB mit ByteBuffer max. 2GB und foreign Memory GC-manages.</p></li><li><p>Allgemeingültigkeit:</p></li><li><p>Sicherheit:  Abkommen von <code>sun.misc.Unsafe</code>;</p></li></ul></div></aside></div></section><section id="_einfacher_funktionsaufruf" class="degrade compactlist" data-auto-animate><h2>Einfacher Funktionsaufruf</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight" data-id="planets"><code class="language-java hljs" data-noescape="true" data-lang="java">import java.lang.foreign.*;

class CallPid {
  public static void main(String... p) throws Throwable {
    var lookup = Linker.nativeLinker().defaultLookup();                    <i class="conum" data-value="1"></i><b>(1)</b>
    var libSymbol = lookup.find("getpid").orElseThrow();                   <i class="conum" data-value="2"></i><b>(2)</b>
    var nativeSig = FunctionDescriptor.of(ValueLayout.JAVA_LONG);          <i class="conum" data-value="3"></i><b>(3)</b>

    Linker cABI = Linker.nativeLinker();
    var getpid = cABI.downcallHandle(libSymbol, nativeSig);                <i class="conum" data-value="4"></i><b>(4)</b>

    System.out.println((long) getpid.invokeExact());                       <i class="conum" data-value="5"></i><b>(5)</b>
  }
}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Lookup für Standard-Symbole</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>adressiertes <em>Symbol</em> – hier via Lookup in den System Libraries</td></tr><tr><td><i class="conum" data-value="3"></i><b>3</b></td><td>gewünschte <em>Java-Signatur</em> des Java Foreign Handles</td></tr><tr><td><i class="conum" data-value="4"></i><b>4</b></td><td>Funktionshandle beziehen</td></tr><tr><td><i class="conum" data-value="5"></i><b>5</b></td><td>Native Funktion aufrufen</td></tr></table></div></div></section><section id="_das_gleiche_zu_zeiten_von_jdk_17" class="degrade" data-auto-animate><h2>… das Gleiche zu Zeiten von JDK 17</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight" data-id="planets"><code class="language-java hljs" data-noescape="true" data-lang="java">import java.lang.invoke.*;
import jdk.incubator.foreign.*;

class CallPid {
  public static void main(String... p) throws Throwable {
    var libSymbol = CLinker.systemLookup().lookup("getpid").orElseThrow();
    var javaSig = MethodType.methodType(long.class);                       <i class="conum" data-value="1"></i><b>(1)</b>
    var nativeSig = FunctionDescriptor.of(CLinker.C_LONG);

    CLinker cABI = CLinker.getInstance();
    var getpid = cABI.downcallHandle(libSymbol, javaSig, nativeSig);       <i class="conum" data-value="2"></i><b>(2)</b>

    System.out.println((long) getpid.invokeExact());
  }
}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Zusätzlich: Definition gewünschter <em>Java-Signatur</em> des Java Foreign Handles</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>…und Verwendung dergleichen</td></tr></table></div></div></section><section id="_komplexeres_beispiel_mit_off_heap_memory" class="degrade" data-auto-animate><h2>Komplexeres Beispiel mit Off-Heap Memory</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-c hljs" data-noescape="true" data-lang="c">int radixsort(const	unsigned char **base,	int	nmemb,
              const unsigned char *table, unsigned endbyte);</code></pre></div></div>
<div class="paragraph"><p><span class="decent xx-small">…sortiert <code>nmemb</code> Strings die jeweils mit <code>endbyte</code> terminiert sind: Der erste String bei <code>base</code></span><br></p></div>
<div class="openblock fragment"><div class="content"><div class="paragraph"><p>↓</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight" data-id="planets"><code class="language-java hljs" data-noescape="true" data-line-numbers="4,5,6,7,8,9,10" data-lang="java">var linker = Linker.nativeLinker();
var stdlib = linker.defaultLookup();

var funcDesc = FunctionDescriptor.ofVoid(
        ADDRESS, JAVA_INT,
        ADDRESS, JAVA_CHAR);

MethodHandle radixsort = linker.downcallHandle(
        stdlib.find("radixsort").orElseThrow(),                            <i class="conum" data-value="1"></i><b>(1)</b>
        funcDesc);</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Handle für die native C-Funktion beziehen</td></tr></table></div></div></div>
<aside class="notes"><div class="paragraph"><p>As a brief example of using the FFM API, here is Java code that obtains a method handle for a C library function radixsort and then uses it to sort four strings which start life in a Java array.</p></div></aside></div></section><section id="_was_möchten_wir_erreichen" class="degrade small compactlist" data-auto-animate><h2>…was möchten wir erreichen?…</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight" data-id="planets"><code class="language-java hljs" data-noescape="true" data-lang="java">String[] javaStrings = {"mouse", "cat", "dog", "car"};
String[] sorted = {"car", "cat", "dog", "mouse"};
int strCount = javaStrings.length;

{
  // 1. Übergabe der Java Strings Tabelle in nativen Speicher

  // 2. Sortieren dergleichen mittels `radixsort` C-Funktion

  // 3. Ergebnis auf den Java-Heap
}

assert Arrays.equals(javaStrings, sorted);</code></pre></div></div></div></section><section id="_das_ganze_live_und_in_farbe" class="degrade small compactlist" data-auto-animate><h2>…das ganze <em>live und in Farbe</em>!</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight" data-id="planets"><code class="language-java hljs" data-noescape="true" data-lang="java">try (Arena offHeap = Arena.ofConfined()) {                                 <i class="conum" data-value="1"></i><b>(1)</b>
    MemorySegment pointers = offHeap.allocateArray(ADDRESS, strCount);     <i class="conum" data-value="2"></i><b>(2)</b>

    for (int i = 0; i &lt; strCount; i++) {                                   <i class="conum" data-value="3"></i><b>(3)</b>
        MemorySegment cString = offHeap.allocateUtf8String(javaStrings[i]);
        pointers.setAtIndex(ADDRESS, i, cString);
    }

    radixsort.invoke(pointers, strCount, MemorySegment.NULL, '\0');        <i class="conum" data-value="4"></i><b>(4)</b>

    for (int i = 0; i &lt; strCount; i++) {
        MemorySegment cString = pointers.getAtIndex(ADDRESS, i);
        cString = cString.reinterpret(Long.MAX_VALUE);                     <i class="conum" data-value="5"></i><b>(5)</b>
        javaStrings[i] = cString.getUtf8String(0);
    }
}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td><code>try</code>-with-<em>Arena</em> steuert allen Off-Heap Speicher und gibt diesen später wieder frei.</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Off-heap MemoryPointer-Tabelle reservieren</td></tr><tr><td><i class="conum" data-value="3"></i><b>3</b></td><td>Java Strings in den Off-Heap kopieren und ihre Pointers in Tabelle einsetzen</td></tr><tr><td><i class="conum" data-value="4"></i><b>4</b></td><td>Aufruf der <code>radixsort</code> C-Funktion zum sortieren der Pointer</td></tr><tr><td><i class="conum" data-value="5"></i><b>5</b></td><td>Aktualisiere Größe des erhaltenen <code>MemorySegment</code> von <code>0</code> auf <code>Long.MAX_VALUE</code></td></tr></table></div>
<aside class="notes"><div class="ulist"><ul><li><p>Erläutere Schritt #1&#8230;&#8203;6</p></li><li><p>Das ganze deutlich gewandelt von FFM aus JDK17.</p><div class="ulist"><ul><li><p>Das werden wir gleich auch noch einmal im Demo des Tool sehen, dass ich noch mit jDK17 aufgezeichnet habe</p></li></ul></div></li></ul></div></aside></div></section><section id="_helferlein_jextract"><h2>Helferlein <code>jextract</code></h2><div class="slide-content"><div class="paragraph"><p>Generiert aus direkt aus <strong><code>.h</code></strong>-Dateien passende <em>API Wrapper</em><br>
als <strong><code>.class</code></strong> oder <strong><code>.java</code></strong> mit den notwendigen Foreign API-Aufrufen.<br>
<span class="decent xx-small">Nicht direkt in JDK 21 enthalten, sondern via Panama EAP Builds (s.u.).</span></p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ jextract -t de.bentolor /usr/include/unistd.h</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">import de.bentolor.unistd_h;

class CallPid {
   public static void main(String[] args) {
      System.out.println( unistd_h.getpid() );
  }
}</code></pre></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>Nicht Teil des JDK, separater Download</p></li><li><p>Erzeugt / Generiert den Boiler Code</p></li><li><p>Da große 89MB <em>LLVM</em> Dependency, vermutlich nie JDK Bestandteil</p></li></ul></div></aside>
<div class="openblock refs"><div class="content"><div class="paragraph"><p><a href="https://jdk.java.net/jextract/">jextract EAP builds</a><br>
<a href="https://github.com/openjdk/jextract">Project Panama jextract</a></p></div></div></div></div></section><section id="_jextract_demo" data-background-size="contain" data-background-video="images/native-python-fast.mp4"></section><section id="_jextract_verwendungsbeispiele"><div class="slide-content"><div class="imageblock"><img src="images/jextract-examples.png" alt="https://github.com/openjdk/jextract/tree/master/samples" height="640"></div>
<div class="paragraph"><p><a href="https://github.com/openjdk/jextract/tree/master/samples" class="bare">https://github.com/openjdk/jextract/tree/master/samples</a></p></div>
<aside class="notes"><div class="paragraph"><p>Viele Beispiele verfügbar</p></div></aside></div></section></section>
<section id="_exkurs_incubator_modules_incubator_jep_11" class="degrade"><h2>Exkurs: Incubator Modules <span class="preview">Incubator</span> <span class="jep"><a href="https://openjdk.java.net/jeps/11">JEP 11</a></span></h2><div class="slide-content"><div class="paragraph"><p>sind <em><span class="underline">experimentelle</span></em> <strong>APIs und Tools</strong> <span class="decent">(nicht: JVM/Sprache)</span>,<br>
welche für Experimente und Feedback bereitgestellt werden.<br></p></div>
<div class="listingblock tgap"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-noescape="true" data-lang="bash">javac --add-modules jdk.incubator.foo …
java  --add-modules jdk.incubator.foo …</code></pre></div></div>
<div class="paragraph"><p><span class="decent"><em>z.B.: ex: HTTP/2 Client, Packaging Tool, Scoped Values, …</em></span>
aktuell: Vector API</p></div>
<div class="paragraph"><p> <br>
<span class="emphasize fragment">Dabei gilt: <em>„Alles im Fluß!“</em></span></p></div>
<aside class="notes"><div class="paragraph"><p>Vieles über Incubator gereift. Manches über viele Iterationen
* Vector: Aktuell 6. Incubator
* FFM: Auch 6 Incubators</p></div>
<div class="paragraph"><p>Anderes: Direkt in GA, z.B.
* Scoped Values: 1. Incubator (v20) → 1. Preview (v21)</p></div></aside></div></section>
<section><section id="_vector_api_incubator" class="lightbg" data-background-video="images/pexels-pressmaster--3141210-geometric-symetric.mp4" data-background-video-loop data-background-video-muted data-background-opacity="1"><h2>Vector API <span class="preview">Incubator</span></h2></section><section id="_das_vektor_api_incubator_jep_448" data-background-video="images/pexels-pressmaster--3141210-geometric-symetric.mp4" data-background-video-loop data-background-video-muted data-background-opacity="0.4"><h2>Das Vektor-API <span class="preview">Incubator</span> <span class="jep"><a href="https://openjdk.java.net/jeps/448">JEP 448</a></span></h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>Introduce an API to express <strong>vector computations</strong> that reliably compile at runtime to optimal vector instructions on supported CPU architectures, thus achieving performance superior to equivalent scalar computations.</p></div></blockquote></div>
<div class="openblock fragment xx-large emphasize"><div class="content"><div class="paragraph"><p>↓<br>
<strong>???</strong></p></div></div></div></div></section><section id="_vektor_was_vektor_rechnung" class="degrade"><h2><em>Vektor</em>-was? → Vektor-<em>Rechnung!</em></h2><div class="slide-content"><div class="imageblock"><img src="images/vector-calculation.png" alt="Vector calcuation example" width="900"></div></div></section><section id="_das_vektor_api_im_portrait" class="columns"><h2>Das Vektor API im Portrait</h2><div class="slide-content"><div class="openblock column is-half small"><div class="content"><div class="ulist"><div class="title">Motivation</div><ul><li><p>SIMD <span class="decent">(Single Instruction Multiple Data)</span>-Features aktueller CPUs <span class="decent">(SSE, AVX, 3DNow, AArch64: Neon)</span>.</p></li><li><p>→ <strong>Performance</strong> &amp; <span class="decent">(Energie-)</span> <strong>Effizienz</strong></p></li></ul></div>
<div class="ulist"><div class="title">Anwendungsfälle</div><ul><li><p>Bild-, Signal- und Textverarbeitung</p></li><li><p>Machine Learning</p></li><li><p>Verschlüsselung</p></li><li><p><em>Banales:</em> Array-Vergleich, Zeichensatz- konvertierungen, …</p></li></ul></div></div></div>
<div class="openblock column is-half small"><div class="content"><div class="ulist"><div class="title">Ziele</div><ul><li><p>Klare &amp; prägnante API</p></li><li><p>Plattform-agnostisch</p></li><li><p>Zuverlässig auf <em>x64</em> und <em>AArch64</em></p></li><li><p>„Graceful degradation“</p></li><li><p>Abgestimmt mit <em>Valhalla</em> <br>
<span class="decent">(value-based classes)</span></p></li></ul></div></div></div>
<aside class="notes"><div class="paragraph"><p>Clear and concise API — The API should be capable of clearly and concisely expressing a wide range of vector computations consisting of sequences of vector operations composed within loops and possibly with control flow. It should be possible to express a computation that is generic with respect to vector size, or the number of lanes per vector, thus enabling such computations to be portable across hardware supporting different vector sizes.</p></div>
<div class="paragraph"><p>Platform agnostic — The API should be CPU architecture agnostic, enabling implementations on multiple architectures supporting vector instructions. As is usual in Java APIs, where platform optimization and portability conflict then we will bias toward making the API portable, even if that results in some platform-specific idioms not being expressible in portable code.</p></div>
<div class="paragraph"><p>Reliable runtime compilation and performance on x64 and AArch64 architectures — On capable x64 architectures the Java runtime, specifically the HotSpot C2 compiler, should compile vector operations to corresponding efficient and performant vector instructions, such as those supported by Streaming SIMD Extensions (SSE) and Advanced Vector Extensions (AVX). Developers should have confidence that the vector operations they express will reliably map closely to relevant vector instructions. On capable ARM AArch64 architectures C2 will, similarly, compile vector operations to the vector instructions supported by NEON and SVE.</p></div>
<div class="paragraph"><p>Graceful degradation — Sometimes a vector computation cannot be fully expressed at runtime as a sequence of vector instructions, perhaps because the architecture does not support some of the required instructions. In such cases the Vector API implementation should degrade gracefully and still function. This may involve issuing warnings if a vector computation cannot be efficiently compiled to vector instructions. On platforms without vectors, graceful degradation will yield code competitive with manually-unrolled loops, where the unroll factor is the number of lanes in the selected vector.</p></div>
<div class="paragraph"><p>Alignment with Project Valhalla — The long-term goal of the Vector API is to leverage Project Valhalla&#8217;s enhancements to the Java object model. Primarily this will mean changing the Vector API&#8217;s current value-based classes to be value classes so that programs can work with value objects, i.e., class instances that lack object identity. Accordingly, the Vector API will incubate over multiple releases until the necessary features of Project Valhalla become available as preview features. Once these Valhalla features are available we will adapt the Vector API and implementation to use them and then promote the Vector API itself to a preview feature. For further details, see the sections on run-time compilation and future work.</p></div></aside></div></section><section id="_vector_api_history"><h2>Vector API: History</h2><div class="slide-content"><table class="tableblock frame-all grid-all x-small" style="width:70%"><colgroup><col style="width:22.2222%"><col style="width:11.1111%"><col style="width:22.2222%"><col style="width:44.4445%"></colgroup><thead><tr><th class="tableblock halign-center valign-top">JEP</th><th class="tableblock halign-center valign-top">JDK</th><th class="tableblock halign-right valign-top">Status</th><th class="tableblock halign-left valign-top">Titel</th></tr><tbody><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="jepinline"><a href="https://openjdk.org/jeps/338">JEP 338</a></span></p></td><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="versioninline">16</span></p></td><td class="tableblock halign-right valign-top"><p class="tableblock"><span class="previewinline">Incubator</span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Vector API</p></td></tr><tr><td class="tableblock halign-center valign-top" colspan="4"></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="jepinline"><a href="https://openjdk.org/jeps/414">JEP 414</a></span></p></td><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="versioninline">17</span></p></td><td class="tableblock halign-right valign-top"><p class="tableblock"><span class="previewinline">2. Incubator</span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Vector API</p></td></tr><tr><td class="tableblock halign-center valign-top" colspan="4"></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="jepinline"><a href="https://openjdk.org/jeps/417">JEP 417</a></span></p></td><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="versioninline">18</span></p></td><td class="tableblock halign-right valign-top"><p class="tableblock"><span class="previewinline">3. Incubator</span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Vector API</p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="jepinline"><a href="https://openjdk.org/jeps/426">JEP 426</a></span></p></td><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="versioninline">19</span></p></td><td class="tableblock halign-right valign-top"><p class="tableblock"><span class="previewinline">4. Incubator</span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Vector API</p></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="jepinline"><a href="https://openjdk.org/jeps/438">JEP 438</a></span></p></td><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="versioninline">20</span></p></td><td class="tableblock halign-right valign-top"><p class="tableblock"><span class="previewinline">5. Incubator</span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Vector API</p></td></tr><tr><td class="tableblock halign-center valign-top" colspan="4"></td></tr><tr><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="jepinline"><a href="https://openjdk.org/jeps/448">JEP 448</a></span></p></td><td class="tableblock halign-center valign-top"><p class="tableblock"><span class="versioninline">21</span></p></td><td class="tableblock halign-right valign-top"><p class="tableblock"><span class="previewinline">6. Incubator</span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Vector API</p></td></tr></table>
<aside class="notes"><div class="ulist"><div class="title">Historie:</div><ul><li><p>Zwei JEPs / APIs: Memory Access API &amp; Foreign Linker API</p></li><li><p>erstmals JDK14, dann 15, 16 und zusammengeführt in 17</p></li><li><p>Nun seit JDK 17 aus Incubator-Status raus, inzwischen 3.te Preview</p></li></ul></div>
<div class="paragraph"><div class="title">Was ist neu seit JDK17?</div><p>Viel Detailpflege</p></div>
<div class="ulist"><ul><li><p>A new API to copy Java arrays to and from memory segments.</p></li><li><p>A more general dereference API</p></li><li><p>A simpler API to obtain method handles &amp; manage temporal dependencies</p></li><li><p>Enhancemtns to facilitate usage with pattern matching</p></li><li><p>Optimize calls to  short-lived functions</p></li><li><p>uvm.</p></li></ul></div></aside></div></section><section id="_vector_api_begriffe" class="columns"><h2>Vector API: Begriffe</h2><div class="slide-content"><div class="openblock column x-small"><div class="content"><div class="dlist"><dl><dt class="hdlist1"><em>Type</em> <span class="decent">(Elemente)</span></dt><dd><p><code>Byte</code>, <code>Short</code>, <code>Integer</code>, <code>Long</code> und <br>
<code>Float</code> &amp; <code>Double</code> sowie ihre Primitiven</p></dd><dt class="hdlist1"><em>Shape</em></dt><dd><p>unterstütze Vektorgrößen von <code>64</code>, <code>128</code>, <code>256</code> und <code>512</code> Bits sowie <code>max</code> Bits.</p></dd><dt class="hdlist1"><em>Species</em></dt><dd><p><em>Shape</em> &amp; <em>Type</em> &#8594; Elemente pro Vektor</p></dd><dt class="hdlist1">Operations</dt><dd><p><em>lane-wise</em> oder<br>
<em>cross-lane</em> <span class="decent">(Sortieren, Betrag, Sum, Avg, …)</span></p></dd></dl></div></div></div>
<div class="openblock column x-small"><div class="content"><div class="imageblock"><img src="images/vector-terms.png" alt="Vector API Terms" width="900"></div></div></div>
<aside class="notes"><div class="dlist"><dl><dt class="hdlist1">cross-lane</dt><dd><p>Sorting; Reducing (Vektor Normal, Sum,Avg, ..)</p></dd></dl></div></aside></div></section><section id="_vektoren_addieren_klassisch" data-auto-animate><h2>Vektoren addieren… „Klassisch“</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight" data-id="code"><code class="language-java hljs" data-noescape="true" data-line-numbers="5,6,7,8,9" data-lang="java">int[] a1 = {2, 49, -12, 3, 11, 32, 11, 455, 0, 283};
int[] a2 = {0, -3, 185, 221, 76, 2, -2, 0, 0, 0};
int[] aResult = new int[a1.length];

for (int i = 0; i &lt; a1.length; i++) {
    aResult[i] = a1[i] + a2[i];
}

System.out.println(aResult[1] == 46 ? "Yep!" : "Duh!");</code></pre></div></div>
<div class="paragraph fragment"><p><code>Yep!</code></p></div></div></section><section id="_mittels_vector_api" data-auto-animate><h2>Mittels Vector API</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight" data-id="code"><code class="language-java hljs" data-noescape="true" data-line-numbers="4,5,6,7,8" data-lang="java">int[] vResult = new int[a1.length];
var species = IntVector.SPECIES_256;

var v1 = IntVector.fromArray(species, a1, 0);
var v2 = IntVector.fromArray(species, a2, 0);

var result = v1.add(v2);
result.intoArray(vResult, 0);

System.out.println(Arrays.equals(aResult, vResult) ? "Yep!" : "Duh!");</code></pre></div></div>
<div class="paragraph fragment emphasize"><p><code>Duh!</code></p></div></div></section><section id="_definiert_die_species_die_anzahl_der_elemente" data-auto-animate><h2>… definiert die „Species“ die Anzahl der Elemente!</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight" data-id="code"><code class="language-java hljs" data-noescape="true" data-line-numbers="1,2" data-lang="java">int[] a1 = {2, 49, -12, 3, 11, 32, 11, 455, /* | */  0, 283};
int[] a2 = {0, -3, 185, 221, 76, 2, -2, 0,  /* | */  0, 0};
int[] vResult = new int[a1.length];
var species = IntVector.SPECIES_256;

var v1 = IntVector.fromArray(species, a1, 0);
var v2 = IntVector.fromArray(species, a2, 0);

var result = v1.add(v2);
result.intoArray(vResult, 0);

System.out.println(Arrays.equals(aResult, vResult) ? "Yep!" : "Duh!");</code></pre></div></div>
<div class="paragraph emphasize"><p><code>Duh!</code></p></div></div></section><section id="_darum_slicing_erforderlich" data-auto-animate><h2>…darum „Slicing“ erforderlich …</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight" data-id="code"><code class="language-java hljs" data-noescape="true" data-line-numbers="6,7,8,9,10,11,12" data-lang="java">int[] a1 = {2, 49, -12, 3, 11, 32, 11, 455, /* | */  0, 283};
int[] a2 = {0, -3, 185, 221, 76, 2, -2, 0,  /* | */  0, 0};
int[] vResult = new int[a1.length];
var species = IntVector.SPECIES_256;

for (int i = 0; i &lt; a1.length; i += species.length()) {

    var v1 = IntVector.fromArray(species, a1, i);
    var v2 = IntVector.fromArray(species, a2, i);
    var result = v1.add(v2);
    result.intoArray(vResult, i);
}

System.out.println(Arrays.equals(aResult, vResult) ? "Yep!" : "Duh!");</code></pre></div></div></div></section><section id="_aber_auch_masking" data-auto-animate><h2>…aber auch „Masking“…</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight" data-id="code"><code class="language-java hljs" data-noescape="true" data-line-numbers="7" data-lang="java">int[] a1 = {2, 49, -12, 3, 11, 32, 11, 455, /* | */  0, 283};
int[] a2 = {0, -3, 185, 221, 76, 2, -2, 0,  /* | */  0, 0};
int[] vResult = new int[a1.length];
var species = IntVector.SPECIES_256;

for (int i = 0; i &lt; a1.length; i += species.length()) {
    var mask = species.indexInRange(i, a1.length);
    var v1 = IntVector.fromArray(species, a1, i, mask);
    var v2 = IntVector.fromArray(species, a2, i, mask);
    var result = v1.add(v2, mask);
    result.intoArray(vResult, i, mask);
}

System.out.println(Arrays.equals(aResult, vResult) ? "Yep!" : "Duh!");</code></pre></div></div></div></section><section id="_um_den_verschnitt_zu_managen" data-auto-animate><h2>… um den „Verschnitt“ zu managen!</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight" data-id="code"><code class="language-java hljs" data-noescape="true" data-line-numbers="8,9,10,11" data-lang="java">int[] a1 = {2, 49, -12, 3, 11, 32, 11, 455, /* | */  0, 283};
int[] a2 = {0, -3, 185, 221, 76, 2, -2, 0,  /* | */  0, 0};
int[] vResult = new int[a1.length];
var species = IntVector.SPECIES_256;

for (int i = 0; i &lt; a1.length; i += species.length()) {
    var mask = species.indexInRange(i, a1.length);
    var v1 = IntVector.fromArray(species, a1, i, mask);
    var v2 = IntVector.fromArray(species, a2, i, mask);
    var result = v1.add(v2, mask);
    result.intoArray(vResult, i, mask);
}

System.out.println(Arrays.equals(aResult, vResult) ? "Yep!" : "Duh!");</code></pre></div></div>
<div class="paragraph fragment"><p><code>Yep!</code></p></div></div></section><section id="_species_sind_plattform_spezifisch" data-auto-animate><h2>„Species“ sind Plattform-spezifisch!</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight" data-id="code"><code class="language-java hljs" data-noescape="true" data-line-numbers="4" data-lang="java">int[] a1 = {2, 49, -12, 3, 11, 32, 11, 455, /* | */  0, 283};
int[] a2 = {0, -3, 185, 221, 76, 2, -2, 0,  /* | */  0, 0};
int[] vResult = new int[a1.length];
var species = IntVector.SPECIES_PREFERRED;

for (int i = 0; i &lt; a1.length; i += species.length()) {
    var mask = species.indexInRange(i, a1.length);
    var v1 = IntVector.fromArray(species, a1, i, mask);
    var v2 = IntVector.fromArray(species, a2, i, mask);
    var result = v1.add(v2, mask);
    result.intoArray(vResult, i, mask);
}

System.out.println(Arrays.equals(aResult, vResult) ? "Yep!" : "Duh!");</code></pre></div></div>
<div class="paragraph fragment"><p>Pitfall: Das <em>Masking</em> wird nicht von allen CPUs unterstüzt!</p></div></div></section><section id="_cross_lane_beispiel"><h2>Cross-Lane Beispiel</h2><div class="slide-content"><div class="paragraph fragment emphasize"><p><strong>|v⃗|= <em>sqrt</em> ( v<sub>1</sub><sup>2</sup> + v<sub>2</sub><sup>2</sup> + v<sub>3</sub><sup>2</sup> + … )</strong></p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-line-numbers="4,8,9,11" data-lang="java">int[] a1 = {2, 49, -12, 3, 11, 32, 11, 455, 0, 283};
var species = IntVector.SPECIES_PREFERRED;

double sqrSums = 0d;
for (int i = 0; i &lt; a1.length; i += species.length()) {
    var mask = species.indexInRange(i, a1.length);
    var v1 = IntVector.fromArray(species, a1, i, mask);
    var v2 = v1.mul(v1, mask);
    sqrSums += v2.reduceLanes(VectorOperators.ADD, mask);
}
double vBetrag = Math.sqrt(sqrSums);</code></pre></div></div>
<div class="paragraph fragment decent"><p>Auch das aufaddieren der Quadrate könnte man wunderbar per Vector-API abbilden!</p></div></div></section><section id="_performance_your_mileage_may_vary" class="degrade"><h2>Performance: <em>„Your mileage may vary!“</em></h2><div class="slide-content"><div class="imageblock plain"><img src="images/EqualsIgnoreCaseBenchmark.png" alt="EqualsIgnoreCase Benchmark" width="1000"></div>
<div class="paragraph small decent"><small> <br>
Starke Abhängigkeit der verfügbaren CPU-Features (z.B. Masking), verfügbaren <em>Shapes</em> und CPU Performance.</small></div></div></section><section id="_vector_api_beispiele_benchmarks" class="degrade x-small"><h2>Vector API: Beispiele &amp; Benchmarks</h2><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="images/vector-benchmarks.png" alt="Vector API Sample Benchmarks"></span> <br>
<a href="https://github.com/openjdk/jdk/tree/master/test/micro/org/openjdk/bench/jdk/incubator/vector" class="bare">https://github.com/openjdk/jdk/tree/master/test/micro/org/openjdk/bench/jdk/incubator/vector</a></p></div></div></section></section>
<section><section id="_tooling" class="lightbg" data-background-video="images/hammer.mp4" data-background-video-loop data-background-opacity="0.8"><h2>Tooling</h2></section><section id="_simple_web_server_jep_408" data-auto-animate data-auto-animate-restart><h2>Simple Web Server <span class="jep"><a href="https://openjdk.java.net/jeps/408">JEP 408</a></span></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight" data-id="code"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ java -m jdk.httpserver -p 4444 -d /tmp -o verbose
Binding an Loopback als Standard. Verwenden Sie für alle Schnittstellen …
Bedient /tmp und Unterverzeichnisse auf 127.0.0.1 Port 4444
URL http://127.0.0.1:4444/</code></pre></div></div>
<div class="paragraph"><p>Unterstützt <em>nur</em> HTTP/1.1, kein HTTPS und nur <code>GET</code> und <code>HEAD</code>.</p></div></div></section><section id="_simple_web_server_jep_408_2" data-auto-animate><h2>Simple Web Server <span class="jep"><a href="https://openjdk.java.net/jeps/408">JEP 408</a></span></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight" data-id="code"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ jwebserver             -p 4444 -d /tmp -o verbose
Binding an Loopback als Standard. Verwenden Sie für alle Schnittstellen …
Bedient /tmp und Unterverzeichnisse auf 127.0.0.1 Port 4444
URL http://127.0.0.1:4444/</code></pre></div></div>
<div class="paragraph"><p>Als Convenience bietet das JDK das Wrapper-Script <code>jwebserver</code> an</p></div></div></section><section id="_simple_web_server_jep_408_3" data-auto-animate><h2>Simple Web Server <span class="jep"><a href="https://openjdk.java.net/jeps/408">JEP 408</a></span></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight" data-id="code"><code class="language-java hljs" data-noescape="true" data-lang="java">public static void main(String[] args) {
    HttpServer server = SimpleFileServer.createFileServer(
            new InetSocketAddress(4444),
            Path.of("/tmp"),
            SimpleFileServer.OutputLevel.VERBOSE);
    server.start();
}</code></pre></div></div>
<div class="paragraph"><p>…auch programmatische Verwendung möglich.</p></div></div></section><section id="_javadoc_code_snippets_jep_413" class="columns left small"><h2><code>javadoc</code> Code Snippets <span class="jep"><a href="https://openjdk.java.net/jeps/413">JEP 413</a></span></h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="ulist"><div class="title">Neues <code>{@snippet : … }</code> tag</div><ul><li><p>Inhalte <em>inline</em> oder über <em>externe Dateien</em></p></li><li><p>Unterstützt verschiedene Snippet-Sprachen</p></li></ul></div>
<div class="listingblock small"><div class="content"><pre class="highlightjs highlight"><code class="language-none hljs" data-noescape="true" data-line-numbers="3,4,7,10,12" data-lang="none">/**
 * Der Evergreen im Portrait.
 * {@snippet :
 * // @highlight region substring="Hello"
 * class HelloWorld {
 *   public static void main(String... args) {
 * // @link regex="Sy.+m" target="java.lang.System" :
 *      System.out.println("Hello World!");
 *   }
 * // @end
 * }
 * }
 */</code></pre></div></div></div></div>
<div class="openblock column fragment"><div class="content"><div class="ulist"><div class="title">Unterstützte Markup Tags:</div><ul><li><p><code>@start</code> &amp; <code>@end</code> <em>Regions</em> für referenzierbare Ausschnitte</p></li><li><p><code>@highlight</code>-ing anhand  RegEx, Regions oder Text</p></li><li><p><code>@replace</code> für Textersetzungen</p></li><li><p><code>@link</code> ermöglicht Verlinkungen</p></li></ul></div>
<div class="paragraph"><p><span class="xx-small decent fragment">Markup-<em>Tags</em> haben die Form <code>@name</code> gefolgt von <em>Argumenten</em> der Form <code>param="wert"</code> und sind als <em>Kommentare</em> in der Sprache des Snippets verfasst. Mit <code>:</code> wirken sie auf die Folgezeile.</span></p></div></div></div></div></section><section id="_javadoc_code_snippets_tags_argumente" class="degrade"><h2>Javadoc Code Snippets: Tags &amp; Argumente</h2><div class="slide-content"><table class="tableblock frame-none grid-all x-small" style="width:70%"><colgroup><col style="width:25%"><col style="width:75%"></colgroup><thead><tr><th class="tableblock halign-right valign-top">Tag</th><th class="tableblock halign-left valign-top">Arguments</th></tr><tbody><tr><td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>@snippet</code></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em><code>class</code>,  <span class="fragment highlight-current-red"><code>file</code></span>, <code>id</code>, <span class="fragment highlight-current-red"><code>lang</code></span>, <code>region</code></em></p></td></tr><tr><td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>@start</code></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em><code>region</code></em></p></td></tr><tr><td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>@end</code></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em><code>region</code></em></p></td></tr><tr><td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>@highlight</code></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em><code>substring</code>, <code>regex</code>, <code>region</code>, <code>type</code></em></p></td></tr><tr><td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>@replace</code></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em><code>substring</code>, <code>regex</code>, <code>region</code>, <code>replacement</code></em></p></td></tr><tr><td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>@link</code></strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><em><code>substring</code>, <code>regex</code>, <code>region</code>, <code>target</code>, <code>type</code></em></p></td></tr></table></div></section><section id="_mehr_javadoc_verbesserungen" class="columns"><h2>Mehr Javadoc Verbesserungen</h2><div class="slide-content"><div class="openblock column is-two-thirds left"><div class="content"><div class="ulist"><ul><li><p><strong>Custom Javascript</strong> integrieren via <code>--add-script interact.js</code></p></li><li><p>Neue <code>--link-modularity-mismatch</code> warning</p></li><li><p>Layoutverbesserung für <strong>Handys</strong></p></li><li><p><em>Preview API</em> Seite erlaubt toggling</p></li><li><p><em>New</em> gibt Überblick</p></li></ul></div></div></div>
<div class="openblock column"><div class="content"><div class="videoblock"><video src="images/javadoc.webm" width="426" height="100%" poster="images/Javadoc%20feature%20demo" controls>Your browser does not support the video tag.</video></div></div></div></div></section></section>
<section><section id="_details_maintenance" class="lightbg" data-background-video="images/pexels-pavel-danilyuk-6158064.mp4" data-background-video-loop data-background-video-muted data-background-opacity="0.7"><h2>Details &amp; Maintenance</h2></section><section id="_es_ist_nicht_einfach_ein_java_anfänger_zu_sein" data-auto-animate><h2>Es ist nicht einfach, ein Java-Anfänger zu sein…</h2></section><section id="_es_ist_nicht_einfach_ein_java_anfänger_zu_sein_2" data-auto-animate><h2>Es ist nicht einfach, ein Java-Anfänger zu sein…</h2><div class="slide-content"><div class="listingblock tgap"><div class="content"><pre class="highlightjs highlight" data-id="animatedcode"><code class="language-java hljs" data-noescape="true" data-line-numbers="" data-lang="java">public class ClassicHello {
    String greeting() { return "Hello, World!"; }

    public static void main(String[] args) {
        System.out.println(new ClassicHello().greeting());
    }
}</code></pre></div></div>
<aside class="notes"><div class="quoteblock"><blockquote><div class="literalblock"><div class="content"><pre>"evolve the Java language so that students can write their first programs without needing to understand language features designed for large programs."</pre></div></div></blockquote></div>
<div class="ulist"><ul><li><p>led by Brian Goetz: Lower initial challenges to newcomers vs.</p><div class="ulist"><ul><li><p>Claim: Concept overload: <code>public</code> + <code>class</code> +<em>Methods</em> + <code>public</code> (again) + <code>static</code> + <code>String[]</code> + <code>System.out.println</code></p></li></ul></div></li></ul></div></aside></div></section><section id="_aber_bald_wird_es_einfacher_sein" data-auto-animate><h2>…aber bald wird es einfacher sein!</h2><div class="slide-content"><div class="listingblock tgap"><div class="content"><pre class="highlightjs highlight" data-id="animatedcode"><code class="language-java hljs" data-noescape="true" data-line-numbers="" data-lang="java">String greeting() { return "Hello, World!"; }

void main() {
    System.out.println(greeting());
}</code></pre></div></div></div></section><section id="_unnamed_classes_and_instance_main_methods_jep_445_preview" class="columns" data-auto-animate><h2>Unnamed Classes and Instance Main Methods <span class="jep"><a href="https://openjdk.java.net/jeps/445">JEP 445</a></span> <span class="preview">Preview</span></h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight" data-id="animatedcode"><code class="language-java hljs" data-noescape="true" data-lang="java">String greeting() { return "Hello, World!"; }

void main() {
    System.out.println(greeting());
}</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ javac --enable-preview --release 21 Hello.java
$ java  --enable-preview              Hello</code></pre></div></div></div></div>
<div class="openblock column is-one-third"><div class="content"><div class="paragraph"><p> <br></p></div>
<div class="olist arabic"><ol class="arabic"><li><p><code>main()</code>-Methoden<br>
auf <em>Instanzen</em></p></li><li><p><em>unnamed classes</em></p></li></ol></div></div></div>
<aside class="notes"><div class="paragraph"><p><a href="https://openjdk.org/projects/amber/design-notes/on-ramp" class="bare">https://openjdk.org/projects/amber/design-notes/on-ramp</a></p></div></aside></div></section><section id="_utf_8_als_standardkodierung_der_java_api_jep_400" data-auto-animate><h2>UTF-8 als Standardkodierung der Java API <span class="jep"><a href="https://openjdk.java.net/jeps/400">JEP 400</a></span></h2><div class="slide-content"><div class="paragraph"><p>Der <em>default charset</em> kommt in der Java API z.B. bei <code>FileReader/Writer</code>, <code>InputStreamReader</code>, <code>Formatter</code> <code>Scanner</code>, u.a. zum Einsatz.</p></div>
<div class="listingblock fragment tgap"><div class="title">Je nach Betriebssystem, Region- und Spracheinstellung:</div><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">java.io.FileReader(“hello.txt”) // -&gt; "こんにちは"         (macOS)
java.io.FileReader(“hello.txt”) // -&gt; "ã?“ã‚“ã?«ã?¡ã? "  (Windows (en-US))
java.io.FileReader(“hello.txt”) // -&gt; "縺ォ縺。縺ッ"       (Windows (ja-JP)</code></pre></div></div>
<div class="paragraph tgap fragment"><p><strong>Verschärfend:</strong> <span class="emphasize">Neuere Java APIs wie <code>Files.write/readString()</code>, und <code>Files.newBufferedReader/Writer()</code> verwendeten dagegen bereits stets UTF-8!</span></p></div></div></section><section id="_utf_8_als_standardkodierung_der_java_api_jep_400_2" data-auto-animate><h2>UTF-8 als Standardkodierung der Java API <span class="jep"><a href="https://openjdk.java.net/jeps/400">JEP 400</a></span></h2><div class="slide-content"><div class="paragraph"><p>Der <em>default charset</em> kommt in der Java API z.B. bei <code>FileReader/Writer</code>, <code>InputStreamReader</code>, <code>Formatter</code> <code>Scanner</code>, u.a. zum Einsatz.</p></div>
<div class="paragraph x-large emphasize tgap boxed"><p><strong>Seit JDK18 wird nun immer UTF-8<br>
als Standardkodierung verwendet!</strong></p></div></div></section><section id="_jahresinspektion" class="small degrade"><h2>„Jahresinspektion“</h2><div class="slide-content"><div class="ulist"><ul><li class="fragment"><p><span class="jepinline"><a href="https://openjdk.java.net/jeps/449">JEP 449</a></span> Der <strong>Windows 32-bit</strong> x86 Port ist <strong>„for Removal“</strong> deprecated.</p></li><li class="fragment"><p><span class="jepinline"><a href="https://openjdk.java.net/jeps/418">JEP 418</a></span> führt ein <em>Service-Provider Interface</em> (SPI) für die <strong>Internet-Address Resolution</strong> ein.<br>
<span class="decent">Das unterstützt Project Loom, neue Protokolle oder Testing.</span></p></li><li class="fragment"><p><span class="jepinline"><a href="https://openjdk.java.net/jeps/451">JEP 451</a></span>  Dynamisches Laden of Agenten führt nun zu einer Warnung (z.B. Mockito).<br>
<span class="decent">Spätere JVMs werden es vorraussichtlich per Default verbieten.</span></p></li><li class="fragment"><p><span class="jepinline"><a href="https://openjdk.java.net/jeps/452">JEP 452</a></span> Die <strong>Key Encapsulation Mechanism (KEM) API</strong>   sichert symmetrische Schlüssel ab.</p></li><li class="fragment"><p><span class="jepinline"><a href="https://openjdk.java.net/jeps/416">JEP 416</a></span> implementiert die <strong>Core Reflection with Method Handles</strong> neu.</p></li><li class="fragment"><p>Mit <span class="jepinline"><a href="https://openjdk.java.net/jeps/416">JEP 416</a></span> wurde <em>Finalization</em> als deprecated markiert.</p></li><li class="fragment"><p><span class="jepinline"><a href="https://openjdk.java.net/jeps/42">JEP 422</a></span> bringt einen neuen Linux/RISC-V Port</p></li><li class="fragment"><p>Der Aufruf <code>new URL("https://bentolor.de")</code> ist nun ebenfalls deprecated</p></li><li class="fragment"><p>Die Umwandlung zwischen Primitives (z.B. <code>long</code> → <code>int</code>) wurde beschleunigt:<br>
<span class="decent">Für Java Serializierung bringt das bis zu +5% Performancegewinn.</span></p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>Windows 10 32bit, the last 32bit version will EOL October 2025.</p></div>
<div class="paragraph"><p>On the performance side, Per Minborg has made improvements in the conversion between primitives (long to int, for example) via the use of VarHandle in place of existing binary calculations. As these conversion operations are widely used within Java serialization, this one takes advantage of them and sees a performance improvement of almost 5%. Other JDK APIs and many libraries also use these conversions and will see their performance improve. More information in Per Minborg’s article: Java 21: Performance Improvements Revealed.</p></div>
<div class="dlist"><dl><dt class="hdlist1">JEP 452, "Key Encapsulation Mechanism API"</dt><dd><p>The new Key Encapsulation Mechanisms (KEMs) API strengthens the cryptographic resilience of Java applications against quantum attacks, simplifying the process of securing symmetric keys and eliminating the need for padding.</p></dd><dt class="hdlist1">JEP 451, "Prepare to Disallow the Dynamic Loading of Agents</dt><dd><p>Dynamic Java agent loading is now deprecated for removal. If used, it will display a WARNING in the JVM log. Java agent loading at application startup remains supported, it is only dynamic loading after application startup that is deprecated. The aim is to improve the integrity of the JVM, as an agent can modify the code of an application, loading it after JVM startup is a security risk.</p></dd></dl></div></aside></div></section></section>
<section><section id="_graalvm" class="lightbg" data-background-video="images/pexels-koolshooters-6909829.mp4" data-background-video-loop data-background-video-muted data-background-opacity="1"><h2>GraalVM</h2></section><section id="_project_metropolis" data-background-image="images/graalvm-architecture.png" data-background-size="contain"><div class="slide-content"><aside class="notes"><div class="ulist"><ul><li><p>Polyglot VM</p></li><li><p>In Java geschrieben VM die auf div. Sprachen zielt</p></li><li><p>gemeinnsame Runtime → multiple language with zero overhead</p></li><li><p>Kann mit LLVM native images produzieren</p></li></ul></div></aside></div></section><section id="_graalvmpolyglot_vm" class="left"><h2>GraalVM&#8201;&#8212;&#8201;Polyglot VM</h2><div class="slide-content"><div class="openblock col2"><div class="content"><div class="ulist"><ul><li><p><strong>Ahead-of Time compiler</strong> <span class="verydecent">(AoT)</span></p></li><li><p>Polyglotte VM für <em>div. Sprachen</em><br>
→ <strong>JVM</strong>  <span class="decent">(Java, Kotlin, Scala, …)</span><br>
→ <strong>LLVM</strong> <span class="decent">(C, C++) → native</span><br>
→ <strong>Java</strong> <span class="decent">Script, Python, Ruby, R</span></p></li></ul></div></div></div>
<div class="openblock col2"><div class="content"><div class="ulist"><ul><li><p>Sprachen <strong>sharen Runtime</strong><br>
<span class="decent">→ Zero Interop Overhead</span></p></li><li><p><strong>Native executables</strong> <em>(SubstrateVM</em>)<br>
<span class="decent">→ Kleiner Startup &amp; Memory</span></p></li><li><p><span class="decent">GraalVM Community &amp; Enterprise</span><br>
 <br>
 </p></li></ul></div></div></div>
<div class="openblock clear tgap fragment"><div class="content"><div class="paragraph"><div class="title">Microservice Frameworks</div><p><em>Helidon, Quarkus.io, Micronaut, Spring Fu, Ktor, …</em><br>
<span class="verydecent x-small">→ zielen auf GraalVM AoT &amp; Microservices, z.B. via IoC zur Compiletime</span></p></div></div></div>
<aside class="notes"><div class="olist arabic"><ol class="arabic"><li><p>Fokus: AoT</p></li><li><p>Mehrteilig:</p><div class="ulist"><ul><li><p>Graal VM &amp; Substrate VM as runtime</p></li></ul></div></li><li><p>Benefits</p><div class="ulist"><ul><li><p>AoT → schnellere Startzeiten vs. JIT</p></li><li><p>Native Images → kleinere Startup/Memory → Container</p></li><li><p>Limitations: Dynamic (Reflection)</p></li><li><p>Beeindruckend: GraalVM ab 21.2 unterstützt ebenfalls JFR</p></li></ul></div></li><li><p>Commercial offerings "GraalVM Enterprise"</p></li><li><p>zahlreiche Frameworks zielen auf GraalVM AoT &amp; Microservices</p><div class="ulist"><ul><li><p>z.B. IoC zur Compiletime via APT vs. Laufzeit</p></li></ul></div></li></ol></div></aside></div></section></section>
<section id="_vielen_dank" class="darkbg stretch" data-background-video="images/industrial.mp4" data-background-video-loop data-background-opacity="0.6"><h2>Vielen Dank!</h2><div class="slide-content"><div class="openblock col3-l x-small"><div class="content"><div class="ulist"><div class="title">Tools</div><ul><li><p><a href="https://www.graalvm.org/">GraalVM</a></p></li><li><p><a href="https://jdk.java.net/panama/">Panama EAP Builds (<code>jextract</code>)</a></p></li><li><p><a href="https://github.com/openjdk/jmc">OpenJDK Mission Control</a></p></li></ul></div>
<div class="ulist"><div class="title">Beispiele</div><ul><li><p><a href="https://github.com/openjdk/jextract/tree/master/samples"><code>jextract</code>-Examples</a></p></li><li><p><a href="https://github.com/openjdk/jdk/tree/master/test/micro/org/openjdk/bench/jdk/incubator/vector">Vector API Sample Benchmarks</a></p></li></ul></div></div></div>
<div class="openblock col3-c x-small"><div class="content"><div class="ulist"><div class="title">Referenzwerke</div><ul><li><p><a href="https://javaalmanac.io/"><strong>Java Almanac</strong></a></p></li><li><p><a href="https://chriswhocodes.com/vm-options-explorer.html">VM Options Explorer</a></p></li><li><p><a href="https://docs.oracle.com/en/java/javase/21/gctuning/">HotSpot Tuning Guide</a></p></li><li><p>Vollständige &amp; detaillierte Release Notes für Java <a href="https://www.oracle.com/java/technologies/javase/18all-relnotes.html">18</a> <a href="https://www.oracle.com/java/technologies/javase/19all-relnotes.html">19</a>, <a href="https://www.oracle.com/java/technologies/javase/20all-relnotes.html">20</a> &amp;  <a href="https://www.oracle.com/java/technologies/javase/21all-relnotes.html">21</a></p></li></ul></div>
<div class="ulist"><div class="title">Artikel</div><ul><li><p>„Java <a href="https://www.happycoders.eu/java/java-19-features/">18</a>, <a href="https://www.happycoders.eu/java/java-19-features/">19</a>, <a href="https://www.happycoders.eu/java/java-20-features/">20</a>, <a href="https://www.happycoders.eu/java/java-21-features/">21</a> Features (with Examples)“</p></li><li><p>JDK <a href="https://tschatzl.github.io/2022/03/14/jdk18-g1-parallel-gc-changes.html">18</a>, <a href="https://tschatzl.github.io/2022/09/16/jdk19-g1-parallel-gc-changes.html">19</a>, <a href="https://tschatzl.github.io/2023/08/04/jdk21-g1-parallel-gc-changes.html">20</a>, <a href="https://tschatzl.github.io/2023/08/04/jdk21-g1-parallel-gc-changes.html">21</a> G1/Parallel/Serial GC changes]</p></li></ul></div>
<div class="ulist"><div class="title">Videos</div><ul><li><p>Empfehlenswert: <a href="https://www.youtube.com/channel/UCmRtPmgnQ04CMUpSUqPfhxQ">Offizieller „Java“-Kanale</a></p></li></ul></div></div></div>
<div class="openblock col3-r x-small"><div class="content"><div class="paragraph"><p><span class="image"><img src="images/java21-lts-presentation-url.png" alt="https://bentolor.github.io/java21-lts-presentation/" width="250"></span><br>
<span class="highlight x-small">Interaktive HTML5 Slides<br>
mit allen Links &amp; Demovideos</span></p></div>
<div class="paragraph"><p><span class="icon"><i class="fab fa-mastodon"></i></span> <a href="https://mastodon.social/@bentolor/"><strong>@<a href="mailto:ben@tolor.de">ben@tolor.de</a></strong></a><br>
<span class="icon"><i class="fa fa-at"></i></span> <a href="mailto:ben@tolor.de">ben@tolor.de</a><br>
<span class="icon"><i class="fa fa-github"></i></span> <a href="https://github.com/bentolor/java21-lts-presentation">bentolor</a></p></div></div></div>
<div class="paragraph clear xx-small highlight tgap"><p>Proudly made with <span class="icon emphasize"><i class="fa fa-heart fa-love"></i></span> and:  <a href="https://docs.asciidoctor.org/reveal.js-converter/latest/"><code>asciidoctor-revealjs</code></a>,
<a href="https://www.pexels.com/">pexels.com</a> &amp; <a href="https://de.freeimages.com/">freeimages.com</a></p></div></div></section></div></div><script src="reveal.js/dist/reveal.js"></script><script>Array.prototype.slice.call(document.querySelectorAll('.slides section')).forEach(function(slide) {
  if (slide.getAttribute('data-background-color')) return;
  // user needs to explicitly say he wants CSS color to override otherwise we might break custom css or theme (#226)
  if (!(slide.classList.contains('canvas') || slide.classList.contains('background'))) return;
  var bgColor = getComputedStyle(slide).backgroundColor;
  if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
    slide.setAttribute('data-background-color', bgColor);
    slide.style.backgroundColor = 'transparent';
  }
});

// More info about config & dependencies:
// - https://github.com/hakimel/reveal.js#configuration
// - https://github.com/hakimel/reveal.js#dependencies
Reveal.initialize({
  // Display presentation control arrows
  controls: false,
  // Help the user learn the controls by providing hints, for example by
  // bouncing the down arrow when they first encounter a vertical slide
  controlsTutorial: true,
  // Determines where controls appear, "edges" or "bottom-right"
  controlsLayout: 'edges',
  // Visibility rule for backwards navigation arrows; "faded", "hidden"
  // or "visible"
  controlsBackArrows: 'faded',
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: 'c/t',
  // Control which views the slide number displays on
  showSlideNumber: 'speaker',
  // Add the current slide number to the URL hash so that reloading the
  // page/copying the URL will return you to the same slide
  hash: false,
  // Push each slide change to the browser history. Implies `hash: true`
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Disables the default reveal.js slide layout so that you can use custom CSS layout
  disableLayout: false,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // See https://github.com/hakimel/reveal.js/#navigation-mode
  navigationMode: 'default',
  // Randomizes the order of slides each time the presentation loads
  shuffle: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags whether to include the current fragment in the URL,
  // so that reloading brings you to the same fragment position
  fragmentInURL: true,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Flags if we should show a help overlay when the questionmark
  // key is pressed
  help: true,
  // Flags if speaker notes should be visible to all viewers
  showNotes: false,
  // Global override for autolaying embedded media (video/audio/iframe)
  // - null: Media will only autoplay if data-autoplay is present
  // - true: All media will autoplay, regardless of individual setting
  // - false: No media will autoplay, regardless of individual setting
  autoPlayMedia: true,
  // Global override for preloading lazy-loaded iframes
  // - null: Iframes with data-src AND data-preload will be loaded when within
  //   the viewDistance, iframes with only data-src will be loaded when visible
  // - true: All iframes with data-src will be loaded when within the viewDistance
  // - false: All iframes with data-src will be loaded only when visible
  preloadIframes: null,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Use this method for navigation when auto-sliding
  autoSlideMethod: Reveal.navigateNext,
  // Specify the average time in seconds that you think you will spend
  // presenting each slide. This is used to show a pacing timer in the
  // speaker view
  defaultTiming: 40,
  // Specify the total time in seconds that is available to
  // present.  If this is set to a nonzero value, the pacing
  // timer will work out the time available for each slide,
  // instead of using the defaultTiming value
  totalTime: 0,
  // Specify the minimum amount of time you want to allot to
  // each slide, if using the totalTime calculation method.  If
  // the automated time allocation causes slide pacing to fall
  // below this threshold, then you will see an alert in the
  // speaker notes window
  minimumTimePerSlide: 0,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hide cursor if inactive
  hideInactiveCursor: true,
  // Time before the cursor is hidden (in ms)
  hideCursorTime: 5000,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  // Add `data-preview-link` and `data-preview-link="false"` to customise each link
  // individually
  previewLinks: false,
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: 'slide',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Number of slides away from the current that are visible on mobile
  // devices. It is advisable to set this to a lower number than
  // viewDistance in order to save resources.
  mobileViewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: 'images/architecture-1216055-colored.bak.jpg',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '3303px 2202px',
  // Number of pixels to move the parallax background per slide
  // - Calculated automatically unless specified
  // - Set to 0 to disable movement along an axis
  parallaxBackgroundHorizontal: null,
  parallaxBackgroundVertical: null,
  // The display mode that will be used to show slides
  display: 'block',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 1408,
  height: 792,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // PDF Export Options
  // Put each fragment on a separate page
  pdfSeparateFragments: true,
  // For slides that do not fit on a page, max number of pages
  pdfMaxPagesPerSlide: 1,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'reveal.js/plugin/zoom/zoom.js', async: true, callback: function () { Reveal.registerPlugin(RevealZoom) } },
      { src: 'reveal.js/plugin/notes/notes.js', async: true, callback: function () { Reveal.registerPlugin(RevealNotes) } }
  ],
});</script><script>var dom = {};
dom.slides = document.querySelector('.reveal .slides');

function getRemainingHeight(element, slideElement, height) {
  height = height || 0;
  if (element) {
    var newHeight, oldHeight = element.style.height;
    // Change the .stretch element height to 0 in order find the height of all
    // the other elements
    element.style.height = '0px';
    // In Overview mode, the parent (.slide) height is set of 700px.
    // Restore it temporarily to its natural height.
    slideElement.style.height = 'auto';
    newHeight = height - slideElement.offsetHeight;
    // Restore the old height, just in case
    element.style.height = oldHeight + 'px';
    // Clear the parent (.slide) height. .removeProperty works in IE9+
    slideElement.style.removeProperty('height');
    return newHeight;
  }
  return height;
}

function layoutSlideContents(width, height) {
  // Handle sizing of elements with the 'stretch' class
  toArray(dom.slides.querySelectorAll('section .stretch')).forEach(function (element) {
    // Determine how much vertical space we can use
    var limit = 5; // hard limit
    var parent = element.parentNode;
    while (parent.nodeName !== 'SECTION' && limit > 0) {
      parent = parent.parentNode;
      limit--;
    }
    if (limit === 0) {
      // unable to find parent, aborting!
      return;
    }
    var remainingHeight = getRemainingHeight(element, parent, height);
    // Consider the aspect ratio of media elements
    if (/(img|video)/gi.test(element.nodeName)) {
      var nw = element.naturalWidth || element.videoWidth, nh = element.naturalHeight || element.videoHeight;
      var es = Math.min(width / nw, remainingHeight / nh);
      element.style.width = (nw * es) + 'px';
      element.style.height = (nh * es) + 'px';
    } else {
      element.style.width = width + 'px';
      element.style.height = remainingHeight + 'px';
    }
  });
}

function toArray(o) {
  return Array.prototype.slice.call(o);
}

Reveal.addEventListener('slidechanged', function () {
  layoutSlideContents(1408, 792)
});
Reveal.addEventListener('ready', function () {
  layoutSlideContents(1408, 792)
});
Reveal.addEventListener('resize', function () {
  layoutSlideContents(1408, 792)
});</script><link rel="stylesheet" href="css/hljs/gradient-dark.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.3/highlight.min.js"></script>

<script>

/* highlightjs-line-numbers.js 2.6.0 | (C) 2018 Yauheni Pakala | MIT License | github.com/wcoder/highlightjs-line-numbers.js */
/* Edited by Hakim for reveal.js; removed async timeout */
!function(n,e){"use strict";function t(){var n=e.createElement("style");n.type="text/css",n.innerHTML=g(".{0}{border-collapse:collapse}.{0} td{padding:0}.{1}:before{content:attr({2})}",[v,L,b]),e.getElementsByTagName("head")[0].appendChild(n)}function r(t){"interactive"===e.readyState||"complete"===e.readyState?i(t):n.addEventListener("DOMContentLoaded",function(){i(t)})}function i(t){try{var r=e.querySelectorAll("code.hljs,code.nohighlight");for(var i in r)r.hasOwnProperty(i)&&l(r[i],t)}catch(o){n.console.error("LineNumbers error: ",o)}}function l(n,e){"object"==typeof n&&f(function(){n.innerHTML=s(n,e)})}function o(n,e){if("string"==typeof n){var t=document.createElement("code");return t.innerHTML=n,s(t,e)}}function s(n,e){e=e||{singleLine:!1};var t=e.singleLine?0:1;return c(n),a(n.innerHTML,t)}function a(n,e){var t=u(n);if(""===t[t.length-1].trim()&&t.pop(),t.length>e){for(var r="",i=0,l=t.length;i<l;i++)r+=g('<tr><td class="{0}"><div class="{1} {2}" {3}="{5}"></div></td><td class="{4}"><div class="{1}">{6}</div></td></tr>',[j,m,L,b,p,i+1,t[i].length>0?t[i]:" "]);return g('<table class="{0}">{1}</table>',[v,r])}return n}function c(n){var e=n.childNodes;for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];h(r.textContent)>0&&(r.childNodes.length>0?c(r):d(r.parentNode))}}function d(n){var e=n.className;if(/hljs-/.test(e)){for(var t=u(n.innerHTML),r=0,i="";r<t.length;r++){var l=t[r].length>0?t[r]:" ";i+=g('<span class="{0}">{1}</span>\n',[e,l])}n.innerHTML=i.trim()}}function u(n){return 0===n.length?[]:n.split(y)}function h(n){return(n.trim().match(y)||[]).length}function f(e){e()}function g(n,e){return n.replace(/{(\d+)}/g,function(n,t){return e[t]?e[t]:n})}var v="hljs-ln",m="hljs-ln-line",p="hljs-ln-code",j="hljs-ln-numbers",L="hljs-ln-n",b="data-line-number",y=/\r\n|\r|\n/g;n.hljs?(n.hljs.initLineNumbersOnLoad=r,n.hljs.lineNumbersBlock=l,n.hljs.lineNumbersValue=o,t()):n.console.error("highlight.js not detected!")}(window,document);

/**
 * This reveal.js plugin is wrapper around the highlight.js
 * syntax highlighting library.
 */
(function( root, factory ) {
  if (typeof define === 'function' && define.amd) {
    root.RevealHighlight = factory();
  } else if( typeof exports === 'object' ) {
    module.exports = factory();
  } else {
    // Browser globals (root is window)
    root.RevealHighlight = factory();
  }
}( this, function() {

  // Function to perform a better "data-trim" on code snippets
  // Will slice an indentation amount on each line of the snippet (amount based on the line having the lowest indentation length)
  function betterTrim(snippetEl) {
    // Helper functions
    function trimLeft(val) {
      // Adapted from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/Trim#Polyfill
      return val.replace(/^[\s\uFEFF\xA0]+/g, '');
    }
    function trimLineBreaks(input) {
      var lines = input.split('\n');

      // Trim line-breaks from the beginning
      for (var i = 0; i < lines.length; i++) {
        if (lines[i].trim() === '') {
          lines.splice(i--, 1);
        } else break;
      }

      // Trim line-breaks from the end
      for (var i = lines.length-1; i >= 0; i--) {
        if (lines[i].trim() === '') {
          lines.splice(i, 1);
        } else break;
      }

      return lines.join('\n');
    }

    // Main function for betterTrim()
    return (function(snippetEl) {
      var content = trimLineBreaks(snippetEl.innerHTML);
      var lines = content.split('\n');
      // Calculate the minimum amount to remove on each line start of the snippet (can be 0)
      var pad = lines.reduce(function(acc, line) {
        if (line.length > 0 && trimLeft(line).length > 0 && acc > line.length - trimLeft(line).length) {
          return line.length - trimLeft(line).length;
        }
        return acc;
      }, Number.POSITIVE_INFINITY);
      // Slice each line with this amount
      return lines.map(function(line, index) {
        return line.slice(pad);
      })
        .join('\n');
    })(snippetEl);
  }

  var RevealHighlight = {

    HIGHLIGHT_STEP_DELIMITER: '|',
    HIGHLIGHT_LINE_DELIMITER: ',',
    HIGHLIGHT_LINE_RANGE_DELIMITER: '-',

    init: function( reveal ) {

      // Read the plugin config options and provide fallbacks
      var config = Reveal.getConfig().highlight || {};
      config.highlightOnLoad = typeof config.highlightOnLoad === 'boolean' ? config.highlightOnLoad : true;
      config.escapeHTML = typeof config.escapeHTML === 'boolean' ? config.escapeHTML : true;

      [].slice.call( reveal.getRevealElement().querySelectorAll( 'pre code' ) ).forEach( function( block ) {

        block.parentNode.className = 'code-wrapper';

        // Code can optionally be wrapped in script template to avoid
        // HTML being parsed by the browser (i.e. when you need to
        // include <, > or & in your code).
        let substitute = block.querySelector( 'script[type="text/template"]' );
        if( substitute ) {
          // textContent handles the HTML entity escapes for us
          block.textContent = substitute.innerHTML;
        }

        // Trim whitespace if the "data-trim" attribute is present
        if( block.hasAttribute( 'data-trim' ) && typeof block.innerHTML.trim === 'function' ) {
          block.innerHTML = betterTrim( block );
        }

        // Escape HTML tags unless the "data-noescape" attrbute is present
        if( config.escapeHTML && !block.hasAttribute( 'data-noescape' )) {
          block.innerHTML = block.innerHTML.replace( /</g,"&lt;").replace(/>/g, '&gt;' );
        }

        // Re-highlight when focus is lost (for contenteditable code)
        block.addEventListener( 'focusout', function( event ) {
          hljs.highlightElement( event.currentTarget );
        }, false );

        if( config.highlightOnLoad ) {
          RevealHighlight.highlightBlock( block );
        }
      } );

      // If we're printing to PDF, scroll the code highlights of
      // all blocks in the deck into view at once
      reveal.on( 'pdf-ready', function() {
        [].slice.call( reveal.getRevealElement().querySelectorAll( 'pre code[data-line-numbers].current-fragment' ) ).forEach( function( block ) {
          RevealHighlight.scrollHighlightedLineIntoView( block, {}, true );
        } );
      } );
    },

    /**
     * Highlights a code block. If the <code> node has the
     * 'data-line-numbers' attribute we also generate slide
     * numbers.
     *
     * If the block contains multiple line highlight steps,
     * we clone the block and create a fragment for each step.
     */
    highlightBlock: function( block ) {

      hljs.highlightElement( block );

      // Don't generate line numbers for empty code blocks
      if( block.innerHTML.trim().length === 0 ) return;

      if( block.hasAttribute( 'data-line-numbers' ) ) {
        hljs.lineNumbersBlock( block, { singleLine: true } );

        var scrollState = { currentBlock: block };

        // If there is at least one highlight step, generate
        // fragments
        var highlightSteps = RevealHighlight.deserializeHighlightSteps( block.getAttribute( 'data-line-numbers' ) );
        if( highlightSteps.length > 1 ) {

          // If the original code block has a fragment-index,
          // each clone should follow in an incremental sequence
          var fragmentIndex = parseInt( block.getAttribute( 'data-fragment-index' ), 10 );

          if( typeof fragmentIndex !== 'number' || isNaN( fragmentIndex ) ) {
            fragmentIndex = null;
          }

          // Generate fragments for all steps except the original block
          highlightSteps.slice(1).forEach( function( highlight ) {

            var fragmentBlock = block.cloneNode( true );
            fragmentBlock.setAttribute( 'data-line-numbers', RevealHighlight.serializeHighlightSteps( [ highlight ] ) );
            fragmentBlock.classList.add( 'fragment' );
            block.parentNode.appendChild( fragmentBlock );
            RevealHighlight.highlightLines( fragmentBlock );

            if( typeof fragmentIndex === 'number' ) {
              fragmentBlock.setAttribute( 'data-fragment-index', fragmentIndex );
              fragmentIndex += 1;
            }
            else {
              fragmentBlock.removeAttribute( 'data-fragment-index' );
            }

            // Scroll highlights into view as we step through them
            fragmentBlock.addEventListener( 'visible', RevealHighlight.scrollHighlightedLineIntoView.bind( Plugin, fragmentBlock, scrollState ) );
            fragmentBlock.addEventListener( 'hidden', RevealHighlight.scrollHighlightedLineIntoView.bind( Plugin, fragmentBlock.previousSibling, scrollState ) );

          } );

          block.removeAttribute( 'data-fragment-index' )
          block.setAttribute( 'data-line-numbers', RevealHighlight.serializeHighlightSteps( [ highlightSteps[0] ] ) );

        }

        // Scroll the first highlight into view when the slide
        // becomes visible. Note supported in IE11 since it lacks
        // support for Element.closest.
        var slide = typeof block.closest === 'function' ? block.closest( 'section:not(.stack)' ) : null;
        if( slide ) {
          var scrollFirstHighlightIntoView = function() {
            RevealHighlight.scrollHighlightedLineIntoView( block, scrollState, true );
            slide.removeEventListener( 'visible', scrollFirstHighlightIntoView );
          }
          slide.addEventListener( 'visible', scrollFirstHighlightIntoView );
        }

        RevealHighlight.highlightLines( block );

      }

    },

    /**
     * Animates scrolling to the first highlighted line
     * in the given code block.
     */
    scrollHighlightedLineIntoView: function( block, scrollState, skipAnimation ) {

      cancelAnimationFrame( scrollState.animationFrameID );

      // Match the scroll position of the currently visible
      // code block
      if( scrollState.currentBlock ) {
        block.scrollTop = scrollState.currentBlock.scrollTop;
      }

      // Remember the current code block so that we can match
      // its scroll position when showing/hiding fragments
      scrollState.currentBlock = block;

      var highlightBounds = RevealHighlight.getHighlightedLineBounds( block )
      var viewportHeight = block.offsetHeight;

      // Subtract padding from the viewport height
      var blockStyles = getComputedStyle( block );
      viewportHeight -= parseInt( blockStyles.paddingTop ) + parseInt( blockStyles.paddingBottom );

      // Scroll position which centers all highlights
      var startTop = block.scrollTop;
      var targetTop = highlightBounds.top + ( Math.min( highlightBounds.bottom - highlightBounds.top, viewportHeight ) - viewportHeight ) / 2;

      // Account for offsets in position applied to the
      // <table> that holds our lines of code
      var lineTable = block.querySelector( '.hljs-ln' );
      if( lineTable ) targetTop += lineTable.offsetTop - parseInt( blockStyles.paddingTop );

      // Make sure the scroll target is within bounds
      targetTop = Math.max( Math.min( targetTop, block.scrollHeight - viewportHeight ), 0 );

      if( skipAnimation === true || startTop === targetTop ) {
        block.scrollTop = targetTop;
      }
      else {

        // Don't attempt to scroll if there is no overflow
        if( block.scrollHeight <= viewportHeight ) return;

        var time = 0;
        var animate = function() {
          time = Math.min( time + 0.02, 1 );

          // Update our eased scroll position
          block.scrollTop = startTop + ( targetTop - startTop ) * RevealHighlight.easeInOutQuart( time );

          // Keep animating unless we've reached the end
          if( time < 1 ) {
            scrollState.animationFrameID = requestAnimationFrame( animate );
          }
        };

        animate();

      }

    },

    /**
     * The easing function used when scrolling.
     */
    easeInOutQuart: function( t ) {

      // easeInOutQuart
      return t<.5 ? 8*t*t*t*t : 1-8*(--t)*t*t*t;

    },

    getHighlightedLineBounds: function( block ) {

      var highlightedLines = block.querySelectorAll( '.highlight-line' );
      if( highlightedLines.length === 0 ) {
        return { top: 0, bottom: 0 };
      }
      else {
        var firstHighlight = highlightedLines[0];
        var lastHighlight = highlightedLines[ highlightedLines.length -1 ];

        return {
          top: firstHighlight.offsetTop,
          bottom: lastHighlight.offsetTop + lastHighlight.offsetHeight
        }
      }

    },

    /**
     * Visually emphasize specific lines within a code block.
     * This only works on blocks with line numbering turned on.
     *
     * @param {HTMLElement} block a <code> block
     * @param {String} [linesToHighlight] The lines that should be
     * highlighted in this format:
     * "1" 		= highlights line 1
     * "2,5"	= highlights lines 2 & 5
     * "2,5-7"	= highlights lines 2, 5, 6 & 7
     */
    highlightLines: function( block, linesToHighlight ) {

      var highlightSteps = RevealHighlight.deserializeHighlightSteps( linesToHighlight || block.getAttribute( 'data-line-numbers' ) );

      if( highlightSteps.length ) {

        highlightSteps[0].forEach( function( highlight ) {

          var elementsToHighlight = [];

          // Highlight a range
          if( typeof highlight.end === 'number' ) {
            elementsToHighlight = [].slice.call( block.querySelectorAll( 'table tr:nth-child(n+'+highlight.start+'):nth-child(-n+'+highlight.end+')' ) );
          }
          // Highlight a single line
          else if( typeof highlight.start === 'number' ) {
            elementsToHighlight = [].slice.call( block.querySelectorAll( 'table tr:nth-child('+highlight.start+')' ) );
          }

          if( elementsToHighlight.length ) {
            elementsToHighlight.forEach( function( lineElement ) {
              lineElement.classList.add( 'highlight-line' );
            } );

            block.classList.add( 'has-highlights' );
          }

        } );

      }

    },

    /**
     * Parses and formats a user-defined string of line
     * numbers to highlight.
     *
     * @example
     * RevealHighlight.deserializeHighlightSteps( '1,2|3,5-10' )
     * // [
     * //   [ { start: 1 }, { start: 2 } ],
     * //   [ { start: 3 }, { start: 5, end: 10 } ]
     * // ]
     */
    deserializeHighlightSteps: function( highlightSteps ) {

      // Remove whitespace
      highlightSteps = highlightSteps.replace( /\s/g, '' );

      // Divide up our line number groups
      highlightSteps = highlightSteps.split( RevealHighlight.HIGHLIGHT_STEP_DELIMITER );

      return highlightSteps.map( function( highlights ) {

        return highlights.split( RevealHighlight.HIGHLIGHT_LINE_DELIMITER ).map( function( highlight ) {

          // Parse valid line numbers
          if( /^[\d-]+$/.test( highlight ) ) {

            highlight = highlight.split( RevealHighlight.HIGHLIGHT_LINE_RANGE_DELIMITER );

            var lineStart = parseInt( highlight[0], 10 ),
              lineEnd = parseInt( highlight[1], 10 );

            if( isNaN( lineEnd ) ) {
              return {
                start: lineStart
              };
            }
            else {
              return {
                start: lineStart,
                end: lineEnd
              };
            }

          }
          // If no line numbers are provided, no code will be highlighted
          else {

            return {};

          }

        } );

      } );

    },

    /**
     * Serializes parsed line number data into a string so
     * that we can store it in the DOM.
     */
    serializeHighlightSteps: function( highlightSteps ) {

      return highlightSteps.map( function( highlights ) {

        return highlights.map( function( highlight ) {

          // Line range
          if( typeof highlight.end === 'number' ) {
            return highlight.start + RevealHighlight.HIGHLIGHT_LINE_RANGE_DELIMITER + highlight.end;
          }
          // Single line
          else if( typeof highlight.start === 'number' ) {
            return highlight.start;
          }
          // All lines
          else {
            return '';
          }

        } ).join( RevealHighlight.HIGHLIGHT_LINE_DELIMITER );

      } ).join( RevealHighlight.HIGHLIGHT_STEP_DELIMITER );

    }

  }

  Reveal.registerPlugin( 'highlight', RevealHighlight );

  return RevealHighlight;

}));
        
hljs.configure({
  ignoreUnescapedHTML: true,
});
hljs.highlightAll();
</script></body></html>